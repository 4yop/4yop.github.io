{"version":3,"file":"js/1124.3f86d5bb.js","mappings":"sKAAA,IAAIA,EAAS,WAAkB,IAAIC,EAAIC,KAAKC,EAAGF,EAAIG,MAAMD,GAAG,OAAOA,EAAG,MAAM,CAACE,YAAY,wBAAwB,CAACF,EAAG,SAAS,CAACG,MAAM,CAAC,OAAS,KAAK,CAACH,EAAG,SAAS,CAACE,YAAY,iBAAiBC,MAAM,CAAC,GAAK,GAAG,GAAK,IAAI,CAACH,EAAG,KAAK,CAACF,EAAIM,GAAG,aAAaJ,EAAG,YAAY,CAACG,MAAM,CAAC,kBAAiB,EAAM,gBAAgBE,KAAM,EAAM,eAAeP,EAAIQ,iBAAiB,OAAS,YAAY,CAACN,EAAG,YAAY,CAACG,MAAM,CAAC,KAAO,UAAU,QAAUL,EAAIS,WAAW,SAAWT,EAAIS,aAAa,CAACT,EAAIM,GAAG,IAAIN,EAAIU,GAAGV,EAAIS,WAAa,WAAa,aAAa,OAAOP,EAAG,MAAM,CAACE,YAAY,iBAAiBC,MAAM,CAAC,KAAO,OAAOM,KAAK,OAAO,CAACX,EAAIM,GAAG,8BAA8B,GAAGJ,EAAG,cAAcA,EAAG,MAAM,CAACE,YAAY,iBAAiB,CAACF,EAAG,KAAK,CAACF,EAAIM,GAAG,eAAeJ,EAAG,YAAY,CAACG,MAAM,CAAC,YAAY,SAASO,GAAG,CAAC,OAASZ,EAAIa,mBAAmBC,MAAM,CAACC,MAAOf,EAAIgB,iBAAkBC,SAAS,SAAUC,GAAMlB,EAAIgB,iBAAiBE,CAAG,EAAEC,WAAW,qBAAqBnB,EAAIoB,GAAIpB,EAAIqB,gBAAgB,SAASC,GAAM,OAAOpB,EAAG,YAAY,CAACqB,IAAID,EAAKE,MAAMnB,MAAM,CAAC,MAAQiB,EAAKE,MAAM,MAAQF,IAAO,IAAG,GAAGpB,EAAG,IAAI,CAACE,YAAY,aAAa,CAACJ,EAAIM,GAAG,OAAON,EAAIU,GAAGV,EAAIgB,iBAAiBS,OAAO,IAAIzB,EAAIU,GAAGV,EAAIgB,iBAAiBU,QAAQ,UAAU,GAAGxB,EAAG,MAAM,CAACE,YAAY,iBAAiB,CAACF,EAAG,KAAK,CAACF,EAAIM,GAAG,eAAeJ,EAAG,iBAAiB,CAACU,GAAG,CAAC,OAASZ,EAAIa,mBAAmBC,MAAM,CAACC,MAAOf,EAAI2B,cAAeV,SAAS,SAAUC,GAAMlB,EAAI2B,cAAcT,CAAG,EAAEC,WAAW,kBAAkBnB,EAAIoB,GAAIpB,EAAI4B,QAAQ,SAASC,GAAO,OAAO3B,EAAG,WAAW,CAACqB,IAAIM,EAAMd,MAAMV,MAAM,CAAC,MAAQwB,EAAMd,MAAM,OAAS,KAAK,CAACb,EAAG,OAAO,CAACE,YAAY,eAAe0B,MAAO,CAAEC,WAAYF,EAAMd,SAAWf,EAAIM,GAAG,IAAIN,EAAIU,GAAGmB,EAAML,OAAO,MAAM,IAAG,IAAI,GAAIxB,EAAIgC,gBAAiB9B,EAAG,MAAM,CAACE,YAAY,iBAAiB,CAACF,EAAG,KAAK,CAACF,EAAIM,GAAG,aAAaJ,EAAG,kBAAkB,CAACA,EAAG,YAAY,CAACG,MAAM,CAAC,KAAO,oBAAoBO,GAAG,CAAC,MAAQ,SAASqB,GAAQ,OAAOjC,EAAIkC,YAAY,IAAK,KAAKhC,EAAG,YAAY,CAACG,MAAM,CAAC,KAAO,mBAAmBO,GAAG,CAAC,MAAQ,SAASqB,GAAQ,OAAOjC,EAAIkC,WAAW,IAAK,MAAM,GAAGhC,EAAG,IAAI,CAACE,YAAY,aAAa,CAACJ,EAAIM,GAAG,SAASN,EAAIU,IAAgB,IAAZV,EAAImC,OAAaC,QAAQ,IAAI,QAAQ,GAAGpC,EAAIqC,KAAKnC,EAAG,YAAY,CAACoC,YAAY,CAAC,MAAQ,OAAO,aAAa,QAAQjC,MAAM,CAAC,KAAO,UAAU,KAAO,QAAQ,UAAYL,EAAIgC,iBAAiBpB,GAAG,CAAC,MAAQZ,EAAIuC,gBAAgB,CAACvC,EAAIM,GAAG,wBAAwB,GAAGJ,EAAG,SAAS,CAACE,YAAY,gBAAgBC,MAAM,CAAC,GAAK,GAAG,GAAK,KAAK,CAACH,EAAG,KAAK,CAACF,EAAIM,GAAG,qBAAqBJ,EAAG,MAAM,CAACE,YAAY,iBAAiBQ,GAAG,CAAC,UAAY,SAASqB,GAAgC,OAAxBA,EAAOO,iBAAwBxC,EAAIyC,UAAUC,MAAM,KAAMC,UAAU,EAAE,WAAa,SAASV,GAAgC,OAAxBA,EAAOO,iBAAwBxC,EAAIyC,UAAUC,MAAM,KAAMC,UAAU,IAAI,CAACzC,EAAG,SAAS,CAAC0C,IAAI,cAAcxC,YAAY,eAAeyC,MAAM,CAAC,cAAe7C,EAAI8C,YAAc9C,EAAIgC,iBAAiB3B,MAAM,CAAC,MAAQL,EAAI+C,YAAY,OAAS/C,EAAIgD,kBAAmBhD,EAAIiD,iBAAkB/C,EAAG,MAAM,CAAC0C,IAAI,cAAcN,YAAY,CAAC,QAAU,QAAQjC,MAAM,CAAC,IAAML,EAAIiD,iBAAiB,IAAM,oBAAoBjD,EAAIqC,KAAMrC,EAAIS,WAAYP,EAAG,MAAM,CAACE,YAAY,mBAAmB,CAACF,EAAG,IAAI,CAACE,YAAY,oBAAoBJ,EAAIM,GAAG,wBAAwBN,EAAIqC,QAAQ,IAAI,EACnlG,EACIa,EAAkB,G,wCCEtB,MAAAC,EAAA,CACA,CAAA3B,MAAA,iBAAAC,MAAA,IAAAC,OAAA,IAAA0B,MAAA,KACA,CAAA5B,MAAA,iBAAAC,MAAA,IAAAC,OAAA,IAAA0B,MAAA,MAGA,OACAC,KAAA,gBAEAC,SAAA,CACAC,MAAA,aAGAC,IAAAA,GACA,OAEAC,cAAA,EAGAR,iBAAA,KACAjB,gBAAA,KACAvB,YAAA,EACAiD,aAAA,EAGArC,eAAA8B,EACAnC,iBAAAmC,EAAA,IAAAA,EAAA,GACAxB,cAAA,UACAC,OAAA,CACA,CAAAJ,MAAA,KAAAT,MAAA,WACA,CAAAS,MAAA,KAAAT,MAAA,WACA,CAAAS,MAAA,KAAAT,MAAA,YAIAoB,MAAA,EACAwB,QAAA,EACAC,QAAA,EACAd,YAAA,EAEA,EAEAe,SAAA,CACAd,WAAAA,GACA,YAAA/B,iBAAA,KAAAA,iBAAAS,MAAA,CACA,EACAuB,YAAAA,GACA,YAAAhC,iBAAA,KAAAA,iBAAAU,OAAA,CACA,GAGAoC,QAAA,CAEAtD,gBAAAA,CAAAuD,GACA,KAAAtD,YAAA,EACA,KAAAiD,aAAA,EACA,KAAA1B,gBAAA,KAEA,MAAAgC,EAAA,IAAAC,WAmBA,OAlBAD,EAAAE,OAAA,UACA,KAAAjB,iBAAAkB,EAAAC,OAAAC,aACA,KAAAC,YAEA,MAAAC,EAAA,KAAAC,MAAAC,YACAF,IAEAA,EAAAL,OAAA,UACA,KAAAR,aAAA,QACA,KAAAgB,wBAAAH,GACA,KAAA9D,YAAA,EACA,KAAAkE,aAAA,EAEAJ,EAAAK,UACAL,EAAAL,SACA,EAEAF,EAAAa,cAAAd,EAAAe,MACA,CACA,EAGA,6BAAAJ,CAAAK,GACA,KAAAC,SAAAC,KAAA,wCACA,IAEA,MAAAC,QAAAC,EAAAA,EAAAA,IAAAJ,GAGAK,EAAAC,IAAAC,gBAAAJ,GACAX,EAAA,IAAAgB,YAGA,IAAAC,SAAAC,IACAlB,EAAAL,OAAA,KACA,KAAAlC,gBAAAuC,EACAc,IAAAK,gBAAAN,GACAK,GAAA,EAEAlB,EAAAoB,IAAAP,CAAA,IAIA,MAAAQ,EAAA,KAAA5D,gBAAA6D,aACAC,EAAA,KAAA9D,gBAAA+D,cAGA,KAAA5D,MAAA,KAAAa,aAAA8C,EAAA,GAGA,MAAAE,EAAAJ,EAAA,KAAAzD,MACA8D,EAAAH,EAAA,KAAA3D,MACA,KAAAwB,SAAA,KAAAZ,YAAAiD,GAAA,EACA,KAAApC,SAAA,KAAAZ,aAAAiD,GAAA,EAEA,KAAAjB,SAAAkB,QAAA,cAEA,OAAAC,GACAC,QAAAD,MAAA,UAAAA,GACA,KAAAnB,SAAAmB,MAAA,eACA,KAAAnE,gBAAA,IACA,CACA,EAGA2C,WAAAA,GACA,SAAA3C,gBAAA,OAEA,MAAAqE,EAAA,KAAA7B,MAAA8B,YACAC,EAAAF,EAAAG,WAAA,MAEAZ,EAAA,KAAA5D,gBAAA6D,aACAC,EAAA,KAAA9D,gBAAA+D,cAGAQ,EAAAE,UAAA,KAAA9E,cACA4E,EAAAG,SAAA,SAAA3D,YAAA,KAAAC,cAIAuD,EAAAI,UACA,KAAA3E,gBACA,IACA4D,EAAAE,EACA,KAAAnC,QAAA,KAAAC,QACAgC,EAAA,KAAAzD,MACA2D,EAAA,KAAA3D,MAEA,EAGAI,aAAAA,GACA,SAAAP,gBAEA,YADA,KAAAgD,SAAA4B,QAAA,cAGA,KAAAjC,cACA,MAAAkC,EAAA,KAAArC,MAAA8B,YAEAO,EAAAC,QAAA5B,IACA,MAAAE,EAAAC,IAAAC,gBAAAJ,GACA6B,EAAAC,SAAAC,cAAA,KACAF,EAAAG,KAAA9B,EACA2B,EAAAI,SAAA,YAAAnG,iBAAAQ,UAAA,IAAA4F,MAAAC,iBACAL,SAAAM,KAAAC,YAAAR,GACAA,EAAAS,QACAR,SAAAM,KAAAG,YAAAV,GACA1B,IAAAK,gBAAAN,EAAA,GACA,iBACA,EAGA3C,SAAAA,CAAAiF,GACA,KAAA1F,kBACA,KAAAc,YAAA,EACA,KAAA6E,OAAAD,EAAAE,SAAAF,EAAAG,QAAA,GAAAD,QACA,KAAAE,OAAAJ,EAAAK,SAAAL,EAAAG,QAAA,GAAAE,QACA,KAAAC,eAAA,KAAArE,QACA,KAAAsE,eAAA,KAAArE,QACAoD,SAAAkB,iBAAA,iBAAAC,QACAnB,SAAAkB,iBAAA,eAAAE,UACApB,SAAAkB,iBAAA,iBAAAC,OAAA,CAAAE,SAAA,IACArB,SAAAkB,iBAAA,gBAAAE,UACA,EACAD,MAAAA,CAAAT,GACA,SAAA5E,WAAA,OACA4E,EAAAlF,iBACA,MAAAoF,EAAAF,EAAAE,SAAAF,EAAAG,QAAA,GAAAD,QACAG,EAAAL,EAAAK,SAAAL,EAAAG,QAAA,GAAAE,QAEAO,EAAAV,EAAA,KAAAD,OACAY,EAAAR,EAAA,KAAAD,OAEA,KAAAnE,QAAA,KAAAqE,eAAAM,EACA,KAAA1E,QAAA,KAAAqE,eAAAM,EAEA,KAAA5D,aACA,EACAyD,QAAAA,GACA,KAAAtF,YAAA,EACAkE,SAAAwB,oBAAA,iBAAAL,QACAnB,SAAAwB,oBAAA,eAAAJ,UACApB,SAAAwB,oBAAA,iBAAAL,OAAA,CAAAE,SAAA,IACArB,SAAAwB,oBAAA,gBAAAJ,SACA,EAEAlG,UAAAA,CAAAuG,GACA,SAAAzG,gBAAA,OAEA,MAAA0G,EAAA,KAAAvG,MAAAsG,EAEAC,EAAA,IAAAA,EAAA,IACA,KAAAvG,MAAAuG,EACA,KAAA/D,cAEA,EAEA9D,iBAAAA,GACA,KAAA8D,aACA,GAGAgE,MAAA,CACA3H,iBAAA,oBACAW,cAAA,oBACAK,gBAAA,sBCnOqQ,I,WCQjQ4G,GAAY,OACd,EACA7I,EACAmD,GACA,EACA,KACA,WACA,MAIF,EAAe0F,EAAiB,O","sources":["webpack://web-tool-vue/./src/views/img/CardPhotoView.vue","webpack://web-tool-vue/src/views/img/CardPhotoView.vue","webpack://web-tool-vue/./src/views/img/CardPhotoView.vue?a788","webpack://web-tool-vue/./src/views/img/CardPhotoView.vue?1f5a"],"sourcesContent":["var render = function render(){var _vm=this,_c=_vm._self._c;return _c('div',{staticClass:\"card-photo-container\"},[_c('el-row',{attrs:{\"gutter\":20}},[_c('el-col',{staticClass:\"controls-panel\",attrs:{\"xs\":24,\"sm\":8}},[_c('h2',[_vm._v(\"证件照生成工具\")]),_c('el-upload',{attrs:{\"show-file-list\":false,\"before-upload\":() => false,\"http-request\":_vm.handleFileUpload,\"accept\":\"image/*\"}},[_c('el-button',{attrs:{\"type\":\"primary\",\"loading\":_vm.processing,\"disabled\":_vm.processing}},[_vm._v(\" \"+_vm._s(_vm.processing ? '正在抠图中...' : '上传照片并去除背景')+\" \")]),_c('div',{staticClass:\"el-upload__tip\",attrs:{\"slot\":\"tip\"},slot:\"tip\"},[_vm._v(\" 纯前端处理，隐私安全。请上传清晰人像照片。 \")])],1),_c('el-divider'),_c('div',{staticClass:\"control-group\"},[_c('h4',[_vm._v(\"1. 选择照片尺寸\")]),_c('el-select',{attrs:{\"value-key\":\"label\"},on:{\"change\":_vm.handleParamChange},model:{value:(_vm.selectedStandard),callback:function ($$v) {_vm.selectedStandard=$$v},expression:\"selectedStandard\"}},_vm._l((_vm.photoStandards),function(item){return _c('el-option',{key:item.label,attrs:{\"label\":item.label,\"value\":item}})}),1),_c('p',{staticClass:\"size-info\"},[_vm._v(\"尺寸: \"+_vm._s(_vm.selectedStandard.width)+\"x\"+_vm._s(_vm.selectedStandard.height)+\" 像素\")])],1),_c('div',{staticClass:\"control-group\"},[_c('h4',[_vm._v(\"2. 选择背景颜色\")]),_c('el-radio-group',{on:{\"change\":_vm.handleParamChange},model:{value:(_vm.selectedColor),callback:function ($$v) {_vm.selectedColor=$$v},expression:\"selectedColor\"}},_vm._l((_vm.colors),function(color){return _c('el-radio',{key:color.value,attrs:{\"label\":color.value,\"border\":\"\"}},[_c('span',{staticClass:\"color-swatch\",style:({ background: color.value })}),_vm._v(\" \"+_vm._s(color.label)+\" \")])}),1)],1),(_vm.foregroundImage)?_c('div',{staticClass:\"control-group\"},[_c('h4',[_vm._v(\"3. 缩放调整\")]),_c('el-button-group',[_c('el-button',{attrs:{\"icon\":\"el-icon-zoom-out\"},on:{\"click\":function($event){return _vm.handleZoom(-0.05)}}}),_c('el-button',{attrs:{\"icon\":\"el-icon-zoom-in\"},on:{\"click\":function($event){return _vm.handleZoom(0.05)}}})],1),_c('p',{staticClass:\"size-info\"},[_vm._v(\"当前缩放: \"+_vm._s((_vm.scale * 100).toFixed(0))+\"%\")])],1):_vm._e(),_c('el-button',{staticStyle:{\"width\":\"100%\",\"margin-top\":\"20px\"},attrs:{\"type\":\"success\",\"size\":\"large\",\"disabled\":!_vm.foregroundImage},on:{\"click\":_vm.downloadPhoto}},[_vm._v(\" 合成并下载证件照 (JPEG) \")])],1),_c('el-col',{staticClass:\"preview-panel\",attrs:{\"xs\":24,\"sm\":16}},[_c('h3',[_vm._v(\"实时预览（鼠标/触摸拖动人像）\")]),_c('div',{staticClass:\"canvas-wrapper\",on:{\"mousedown\":function($event){$event.preventDefault();return _vm.startDrag.apply(null, arguments)},\"touchstart\":function($event){$event.preventDefault();return _vm.startDrag.apply(null, arguments)}}},[_c('canvas',{ref:\"photoCanvas\",staticClass:\"photo-canvas\",class:{'is-dragging': _vm.isDragging && _vm.foregroundImage},attrs:{\"width\":_vm.canvasWidth,\"height\":_vm.canvasHeight}})]),(_vm.uploadedImageUrl)?_c('img',{ref:\"uploadImage\",staticStyle:{\"display\":\"none\"},attrs:{\"src\":_vm.uploadedImageUrl,\"alt\":\"Uploaded Image\"}}):_vm._e(),(_vm.processing)?_c('div',{staticClass:\"loading-overlay\"},[_c('i',{staticClass:\"el-icon-loading\"}),_vm._v(\" AI 正在抠图处理... 请稍候 \")]):_vm._e()])],1)],1)\n}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<script>\r\nimport { removeBackground } from \"@imgly/background-removal\";\r\n\r\n// 定义证件照标准\r\nconst PHOTO_STANDARDS = [\r\n  { label: '一寸 (295x413px)', width: 295, height: 413, ratio: 1.4 },\r\n  { label: '二寸 (413x579px)', width: 413, height: 579, ratio: 1.4 },\r\n];\r\n\r\nexport default {\r\n  name: 'CardPhotoView',\r\n\r\n  metaInfo: {\r\n    title: '纯前端证件照生成器',\r\n  },\r\n\r\n  data() {\r\n    return {\r\n      // --- AI/模型状态 ---\r\n      modelLoading: false, // @imgly 库不需要预加载大模型\r\n\r\n      // --- 图片和处理状态 ---\r\n      uploadedImageUrl: null,\r\n      foregroundImage: null,  // 存储抠图后带透明背景的人像 Image 对象\r\n      processing: false,\r\n      imageLoaded: false,\r\n\r\n      // --- 证件照参数 ---\r\n      photoStandards: PHOTO_STANDARDS,\r\n      selectedStandard: PHOTO_STANDARDS[1] || PHOTO_STANDARDS[0],\r\n      selectedColor: '#0070c0',\r\n      colors: [\r\n        { label: '蓝底', value: '#0070c0' },\r\n        { label: '白底', value: '#ffffff' },\r\n        { label: '红底', value: '#d0021b' },\r\n      ],\r\n\r\n      // --- 交互/拖动状态 (Canvas 绘制参数) ---\r\n      scale: 1.0,\r\n      offsetX: 0,\r\n      offsetY: 0,\r\n      isDragging: false,\r\n    };\r\n  },\r\n\r\n  computed: {\r\n    canvasWidth() {\r\n      return this.selectedStandard ? this.selectedStandard.width : 0;\r\n    },\r\n    canvasHeight() {\r\n      return this.selectedStandard ? this.selectedStandard.height : 0;\r\n    }\r\n  },\r\n\r\n  methods: {\r\n    // --- 文件上传处理 ---\r\n    handleFileUpload(file) {\r\n      this.processing = true;\r\n      this.imageLoaded = false;\r\n      this.foregroundImage = null; // 清空上次结果\r\n\r\n      const reader = new FileReader();\r\n      reader.onload = async (e) => {\r\n        this.uploadedImageUrl = e.target.result;\r\n        await this.$nextTick();\r\n\r\n        const img = this.$refs.uploadImage;\r\n        if (!img) return;\r\n\r\n        img.onload = async () => {\r\n          this.imageLoaded = true;\r\n          await this.handleBackgroundRemoval(img);\r\n          this.processing = false;\r\n          this.renderPhoto();\r\n        }\r\n        if (img.complete) {\r\n          img.onload();\r\n        }\r\n      };\r\n      reader.readAsDataURL(file.raw);\r\n      return false;\r\n    },\r\n\r\n    // --- 步骤 2: 背景去除 (使用 @imgly/background-removal) ---\r\n    async handleBackgroundRemoval(imgElement) {\r\n      this.$message.info('正在调用 @imgly/background-removal 抠图...');\r\n      try {\r\n        // 1. 调用背景去除库，返回一个 Blob 对象\r\n        const blob = await removeBackground(imgElement);\r\n\r\n        // 2. 将 Blob 转换为 HTML Image 对象\r\n        const url = URL.createObjectURL(blob);\r\n        const img = new Image();\r\n\r\n        // 异步等待图片加载\r\n        await new Promise((resolve) => {\r\n          img.onload = () => {\r\n            this.foregroundImage = img;\r\n            URL.revokeObjectURL(url); // 释放内存\r\n            resolve();\r\n          };\r\n          img.src = url;\r\n        });\r\n\r\n        // 3. 设置初始位置和缩放\r\n        const inputWidth = this.foregroundImage.naturalWidth;\r\n        const inputHeight = this.foregroundImage.naturalHeight;\r\n\r\n        // 初始缩放：使图片高度略小于 Canvas 高度\r\n        this.scale = this.canvasHeight / inputHeight * 0.9;\r\n\r\n        // 初始偏移：居中\r\n        const scaledW = inputWidth * this.scale;\r\n        const scaledH = inputHeight * this.scale;\r\n        this.offsetX = (this.canvasWidth - scaledW) / 2;\r\n        this.offsetY = (this.canvasHeight - scaledH) / 2;\r\n\r\n        this.$message.success('抠图完成，请调整位置。');\r\n\r\n      } catch (error) {\r\n        console.error(\"背景去除失败:\", error);\r\n        this.$message.error('背景去除服务调用失败。');\r\n        this.foregroundImage = null;\r\n      }\r\n    },\r\n\r\n    // --- 步骤 3: Canvas 渲染 (简化版) ---\r\n    renderPhoto() {\r\n      if (!this.foregroundImage) return;\r\n\r\n      const finalCanvas = this.$refs.photoCanvas;\r\n      const finalCtx = finalCanvas.getContext('2d');\r\n\r\n      const inputWidth = this.foregroundImage.naturalWidth;\r\n      const inputHeight = this.foregroundImage.naturalHeight;\r\n\r\n      // 1. 清理并填充背景色 (只合成框内内容)\r\n      finalCtx.fillStyle = this.selectedColor;\r\n      finalCtx.fillRect(0, 0, this.canvasWidth, this.canvasHeight);\r\n\r\n      // 2. 绘制前景图像 (应用拖动和缩放)\r\n      // 溢出 Canvas 的部分会被自动裁剪，完美满足需求\r\n      finalCtx.drawImage(\r\n          this.foregroundImage,\r\n          0, 0,\r\n          inputWidth, inputHeight,\r\n          this.offsetX, this.offsetY,\r\n          inputWidth * this.scale,\r\n          inputHeight * this.scale\r\n      );\r\n    },\r\n\r\n    // --- 步骤 4: 下载 (逻辑不变) ---\r\n    downloadPhoto() {\r\n      if (!this.foregroundImage) {\r\n        this.$message.warning('请先上传并处理照片。');\r\n        return;\r\n      }\r\n      this.renderPhoto(); // 确保渲染的是最终版本\r\n      const canvas = this.$refs.photoCanvas;\r\n\r\n      canvas.toBlob((blob) => {\r\n        const url = URL.createObjectURL(blob);\r\n        const a = document.createElement('a');\r\n        a.href = url;\r\n        a.download = `证件照_${this.selectedStandard.label}_${new Date().getTime()}.jpeg`;\r\n        document.body.appendChild(a);\r\n        a.click();\r\n        document.body.removeChild(a);\r\n        URL.revokeObjectURL(url);\r\n      }, 'image/jpeg', 0.95);\r\n    },\r\n\r\n    // --- 交互控制 (拖动/缩放/参数改变，逻辑不变) ---\r\n    startDrag(event) {\r\n      if (!this.foregroundImage) return;\r\n      this.isDragging = true;\r\n      this.startX = event.clientX || event.touches[0].clientX;\r\n      this.startY = event.clientY || event.touches[0].clientY;\r\n      this.initialOffsetX = this.offsetX;\r\n      this.initialOffsetY = this.offsetY;\r\n      document.addEventListener('mousemove', this.onDrag);\r\n      document.addEventListener('mouseup', this.stopDrag);\r\n      document.addEventListener('touchmove', this.onDrag, { passive: false });\r\n      document.addEventListener('touchend', this.stopDrag);\r\n    },\r\n    onDrag(event) {\r\n      if (!this.isDragging) return;\r\n      event.preventDefault();\r\n      const clientX = event.clientX || event.touches[0].clientX;\r\n      const clientY = event.clientY || event.touches[0].clientY;\r\n\r\n      const dx = clientX - this.startX;\r\n      const dy = clientY - this.startY;\r\n\r\n      this.offsetX = this.initialOffsetX + dx;\r\n      this.offsetY = this.initialOffsetY + dy;\r\n\r\n      this.renderPhoto();\r\n    },\r\n    stopDrag() {\r\n      this.isDragging = false;\r\n      document.removeEventListener('mousemove', this.onDrag);\r\n      document.removeEventListener('mouseup', this.stopDrag);\r\n      document.removeEventListener('touchmove', this.onDrag, { passive: false });\r\n      document.removeEventListener('touchend', this.stopDrag);\r\n    },\r\n\r\n    handleZoom(delta) {\r\n      if (!this.foregroundImage) return;\r\n\r\n      const newScale = this.scale + delta;\r\n      // 允许较大幅度的缩放，满足溢出需求\r\n      if (newScale > 0.3 && newScale < 5.0) {\r\n        this.scale = newScale;\r\n        this.renderPhoto();\r\n      }\r\n    },\r\n\r\n    handleParamChange() {\r\n      this.renderPhoto();\r\n    }\r\n  },\r\n\r\n  watch: {\r\n    selectedStandard: 'handleParamChange',\r\n    selectedColor: 'handleParamChange',\r\n    foregroundImage: 'handleParamChange'\r\n  }\r\n};\r\n</script>\r\n\r\n<template>\r\n  <div class=\"card-photo-container\">\r\n    <el-row :gutter=\"20\">\r\n\r\n      <el-col :xs=\"24\" :sm=\"8\" class=\"controls-panel\">\r\n        <h2>证件照生成工具</h2>\r\n\r\n        <el-upload\r\n            :show-file-list=\"false\"\r\n            :before-upload=\"() => false\"\r\n            :http-request=\"handleFileUpload\"\r\n            accept=\"image/*\"\r\n        >\r\n          <el-button\r\n              type=\"primary\"\r\n              :loading=\"processing\"\r\n              :disabled=\"processing\"\r\n          >\r\n            {{ processing ? '正在抠图中...' : '上传照片并去除背景' }}\r\n          </el-button>\r\n          <div slot=\"tip\" class=\"el-upload__tip\">\r\n            纯前端处理，隐私安全。请上传清晰人像照片。\r\n          </div>\r\n        </el-upload>\r\n\r\n        <el-divider></el-divider>\r\n\r\n        <div class=\"control-group\">\r\n          <h4>1. 选择照片尺寸</h4>\r\n          <el-select v-model=\"selectedStandard\" value-key=\"label\" @change=\"handleParamChange\">\r\n            <el-option\r\n                v-for=\"item in photoStandards\"\r\n                :key=\"item.label\"\r\n                :label=\"item.label\"\r\n                :value=\"item\"\r\n            ></el-option>\r\n          </el-select>\r\n          <p class=\"size-info\">尺寸: {{ selectedStandard.width }}x{{ selectedStandard.height }} 像素</p>\r\n        </div>\r\n\r\n        <div class=\"control-group\">\r\n          <h4>2. 选择背景颜色</h4>\r\n          <el-radio-group v-model=\"selectedColor\" @change=\"handleParamChange\">\r\n            <el-radio\r\n                v-for=\"color in colors\"\r\n                :key=\"color.value\"\r\n                :label=\"color.value\"\r\n                border\r\n            >\r\n              <span :style=\"{ background: color.value }\" class=\"color-swatch\"></span>\r\n              {{ color.label }}\r\n            </el-radio>\r\n          </el-radio-group>\r\n        </div>\r\n\r\n        <div class=\"control-group\" v-if=\"foregroundImage\">\r\n          <h4>3. 缩放调整</h4>\r\n          <el-button-group>\r\n            <el-button icon=\"el-icon-zoom-out\" @click=\"handleZoom(-0.05)\"></el-button>\r\n            <el-button icon=\"el-icon-zoom-in\" @click=\"handleZoom(0.05)\"></el-button>\r\n          </el-button-group>\r\n          <p class=\"size-info\">当前缩放: {{ (scale * 100).toFixed(0) }}%</p>\r\n        </div>\r\n\r\n        <el-button\r\n            type=\"success\"\r\n            size=\"large\"\r\n            :disabled=\"!foregroundImage\"\r\n            @click=\"downloadPhoto\"\r\n            style=\"width: 100%; margin-top: 20px;\"\r\n        >\r\n          合成并下载证件照 (JPEG)\r\n        </el-button>\r\n\r\n      </el-col>\r\n\r\n      <el-col :xs=\"24\" :sm=\"16\" class=\"preview-panel\">\r\n        <h3>实时预览（鼠标/触摸拖动人像）</h3>\r\n        <div\r\n            class=\"canvas-wrapper\"\r\n            @mousedown.prevent=\"startDrag\"\r\n            @touchstart.prevent=\"startDrag\"\r\n        >\r\n          <canvas\r\n              ref=\"photoCanvas\"\r\n              :width=\"canvasWidth\"\r\n              :height=\"canvasHeight\"\r\n              class=\"photo-canvas\"\r\n              :class=\"{'is-dragging': isDragging && foregroundImage}\"\r\n          ></canvas>\r\n        </div>\r\n\r\n        <img\r\n            v-if=\"uploadedImageUrl\"\r\n            :src=\"uploadedImageUrl\"\r\n            ref=\"uploadImage\"\r\n            style=\"display: none;\"\r\n            alt=\"Uploaded Image\"\r\n        />\r\n\r\n        <div v-if=\"processing\" class=\"loading-overlay\">\r\n          <i class=\"el-icon-loading\"></i> AI 正在抠图处理... 请稍候\r\n        </div>\r\n      </el-col>\r\n    </el-row>\r\n  </div>\r\n</template>\r\n\r\n<style scoped>\r\n/* 移动端适配样式 */\r\n.card-photo-container {\r\n  padding: 10px;\r\n}\r\n.controls-panel {\r\n  padding-right: 20px;\r\n}\r\n.control-group {\r\n  margin-bottom: 20px;\r\n}\r\n.canvas-wrapper {\r\n  /* 确保 Canvas 区域可以被拖动 */\r\n  touch-action: none;\r\n  cursor: grab;\r\n  display: flex;\r\n  justify-content: center;\r\n  align-items: center;\r\n  max-width: 100%;\r\n  overflow: hidden;\r\n  margin-top: 20px;\r\n  background-color: #f5f5f5;\r\n}\r\n.photo-canvas {\r\n  max-width: 100%;\r\n  height: auto;\r\n  border: 1px solid #ccc;\r\n  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);\r\n  transition: box-shadow 0.1s;\r\n}\r\n.photo-canvas.is-dragging {\r\n  cursor: grabbing;\r\n  box-shadow: 0 0 15px rgba(64, 158, 255, 0.8);\r\n}\r\n.size-info {\r\n  font-size: 12px;\r\n  color: #999;\r\n  margin-top: 5px;\r\n}\r\n.color-swatch {\r\n  display: inline-block;\r\n  width: 18px;\r\n  height: 18px;\r\n  border-radius: 3px;\r\n  vertical-align: middle;\r\n  margin-right: 5px;\r\n  border: 1px solid #ccc;\r\n}\r\n.loading-overlay {\r\n  text-align: center;\r\n  padding: 20px;\r\n  color: #409EFF;\r\n}\r\n@media screen and (max-width: 768px) {\r\n  .controls-panel {\r\n    padding-right: 0;\r\n    margin-bottom: 20px;\r\n  }\r\n}\r\n</style>","import mod from \"-!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js??clonedRuleSet-40.use[1]!../../../node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./CardPhotoView.vue?vue&type=script&lang=js\"; export default mod; export * from \"-!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js??clonedRuleSet-40.use[1]!../../../node_modules/@vue/vue-loader-v15/lib/index.js??vue-loader-options!./CardPhotoView.vue?vue&type=script&lang=js\"","import { render, staticRenderFns } from \"./CardPhotoView.vue?vue&type=template&id=030c580b&scoped=true\"\nimport script from \"./CardPhotoView.vue?vue&type=script&lang=js\"\nexport * from \"./CardPhotoView.vue?vue&type=script&lang=js\"\nimport style0 from \"./CardPhotoView.vue?vue&type=style&index=0&id=030c580b&prod&scoped=true&lang=css\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/@vue/vue-loader-v15/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"030c580b\",\n  null\n  \n)\n\nexport default component.exports"],"names":["render","_vm","this","_c","_self","staticClass","attrs","_v","before-upload","handleFileUpload","processing","_s","slot","on","handleParamChange","model","value","selectedStandard","callback","$$v","expression","_l","photoStandards","item","key","label","width","height","selectedColor","colors","color","style","background","foregroundImage","$event","handleZoom","scale","toFixed","_e","staticStyle","downloadPhoto","preventDefault","startDrag","apply","arguments","ref","class","isDragging","canvasWidth","canvasHeight","uploadedImageUrl","staticRenderFns","PHOTO_STANDARDS","ratio","name","metaInfo","title","data","modelLoading","imageLoaded","offsetX","offsetY","computed","methods","file","reader","FileReader","onload","e","target","result","$nextTick","img","$refs","uploadImage","handleBackgroundRemoval","renderPhoto","complete","readAsDataURL","raw","imgElement","$message","info","blob","removeBackground","url","URL","createObjectURL","Image","Promise","resolve","revokeObjectURL","src","inputWidth","naturalWidth","inputHeight","naturalHeight","scaledW","scaledH","success","error","console","finalCanvas","photoCanvas","finalCtx","getContext","fillStyle","fillRect","drawImage","warning","canvas","toBlob","a","document","createElement","href","download","Date","getTime","body","appendChild","click","removeChild","event","startX","clientX","touches","startY","clientY","initialOffsetX","initialOffsetY","addEventListener","onDrag","stopDrag","passive","dx","dy","removeEventListener","delta","newScale","watch","component"],"sourceRoot":""}