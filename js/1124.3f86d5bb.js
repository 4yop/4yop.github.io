"use strict";(self["webpackChunkweb_tool_vue"]=self["webpackChunkweb_tool_vue"]||[]).push([[1124],{21124:function(e,t,a){a.r(t),a.d(t,{default:function(){return h}});var s=function(){var e=this,t=e._self._c;return t("div",{staticClass:"card-photo-container"},[t("el-row",{attrs:{gutter:20}},[t("el-col",{staticClass:"controls-panel",attrs:{xs:24,sm:8}},[t("h2",[e._v("证件照生成工具")]),t("el-upload",{attrs:{"show-file-list":!1,"before-upload":()=>!1,"http-request":e.handleFileUpload,accept:"image/*"}},[t("el-button",{attrs:{type:"primary",loading:e.processing,disabled:e.processing}},[e._v(" "+e._s(e.processing?"正在抠图中...":"上传照片并去除背景")+" ")]),t("div",{staticClass:"el-upload__tip",attrs:{slot:"tip"},slot:"tip"},[e._v(" 纯前端处理，隐私安全。请上传清晰人像照片。 ")])],1),t("el-divider"),t("div",{staticClass:"control-group"},[t("h4",[e._v("1. 选择照片尺寸")]),t("el-select",{attrs:{"value-key":"label"},on:{change:e.handleParamChange},model:{value:e.selectedStandard,callback:function(t){e.selectedStandard=t},expression:"selectedStandard"}},e._l(e.photoStandards,(function(e){return t("el-option",{key:e.label,attrs:{label:e.label,value:e}})})),1),t("p",{staticClass:"size-info"},[e._v("尺寸: "+e._s(e.selectedStandard.width)+"x"+e._s(e.selectedStandard.height)+" 像素")])],1),t("div",{staticClass:"control-group"},[t("h4",[e._v("2. 选择背景颜色")]),t("el-radio-group",{on:{change:e.handleParamChange},model:{value:e.selectedColor,callback:function(t){e.selectedColor=t},expression:"selectedColor"}},e._l(e.colors,(function(a){return t("el-radio",{key:a.value,attrs:{label:a.value,border:""}},[t("span",{staticClass:"color-swatch",style:{background:a.value}}),e._v(" "+e._s(a.label)+" ")])})),1)],1),e.foregroundImage?t("div",{staticClass:"control-group"},[t("h4",[e._v("3. 缩放调整")]),t("el-button-group",[t("el-button",{attrs:{icon:"el-icon-zoom-out"},on:{click:function(t){return e.handleZoom(-.05)}}}),t("el-button",{attrs:{icon:"el-icon-zoom-in"},on:{click:function(t){return e.handleZoom(.05)}}})],1),t("p",{staticClass:"size-info"},[e._v("当前缩放: "+e._s((100*e.scale).toFixed(0))+"%")])],1):e._e(),t("el-button",{staticStyle:{width:"100%","margin-top":"20px"},attrs:{type:"success",size:"large",disabled:!e.foregroundImage},on:{click:e.downloadPhoto}},[e._v(" 合成并下载证件照 (JPEG) ")])],1),t("el-col",{staticClass:"preview-panel",attrs:{xs:24,sm:16}},[t("h3",[e._v("实时预览（鼠标/触摸拖动人像）")]),t("div",{staticClass:"canvas-wrapper",on:{mousedown:function(t){return t.preventDefault(),e.startDrag.apply(null,arguments)},touchstart:function(t){return t.preventDefault(),e.startDrag.apply(null,arguments)}}},[t("canvas",{ref:"photoCanvas",staticClass:"photo-canvas",class:{"is-dragging":e.isDragging&&e.foregroundImage},attrs:{width:e.canvasWidth,height:e.canvasHeight}})]),e.uploadedImageUrl?t("img",{ref:"uploadImage",staticStyle:{display:"none"},attrs:{src:e.uploadedImageUrl,alt:"Uploaded Image"}}):e._e(),e.processing?t("div",{staticClass:"loading-overlay"},[t("i",{staticClass:"el-icon-loading"}),e._v(" AI 正在抠图处理... 请稍候 ")]):e._e()])],1)],1)},o=[],n=(a(14603),a(47566),a(98721),a(45492));const i=[{label:"一寸 (295x413px)",width:295,height:413,ratio:1.4},{label:"二寸 (413x579px)",width:413,height:579,ratio:1.4}];var r={name:"CardPhotoView",metaInfo:{title:"纯前端证件照生成器"},data(){return{modelLoading:!1,uploadedImageUrl:null,foregroundImage:null,processing:!1,imageLoaded:!1,photoStandards:i,selectedStandard:i[1]||i[0],selectedColor:"#0070c0",colors:[{label:"蓝底",value:"#0070c0"},{label:"白底",value:"#ffffff"},{label:"红底",value:"#d0021b"}],scale:1,offsetX:0,offsetY:0,isDragging:!1}},computed:{canvasWidth(){return this.selectedStandard?this.selectedStandard.width:0},canvasHeight(){return this.selectedStandard?this.selectedStandard.height:0}},methods:{handleFileUpload(e){this.processing=!0,this.imageLoaded=!1,this.foregroundImage=null;const t=new FileReader;return t.onload=async e=>{this.uploadedImageUrl=e.target.result,await this.$nextTick();const t=this.$refs.uploadImage;t&&(t.onload=async()=>{this.imageLoaded=!0,await this.handleBackgroundRemoval(t),this.processing=!1,this.renderPhoto()},t.complete&&t.onload())},t.readAsDataURL(e.raw),!1},async handleBackgroundRemoval(e){this.$message.info("正在调用 @imgly/background-removal 抠图...");try{const t=await(0,n.hS)(e),a=URL.createObjectURL(t),s=new Image;await new Promise((e=>{s.onload=()=>{this.foregroundImage=s,URL.revokeObjectURL(a),e()},s.src=a}));const o=this.foregroundImage.naturalWidth,i=this.foregroundImage.naturalHeight;this.scale=this.canvasHeight/i*.9;const r=o*this.scale,l=i*this.scale;this.offsetX=(this.canvasWidth-r)/2,this.offsetY=(this.canvasHeight-l)/2,this.$message.success("抠图完成，请调整位置。")}catch(t){console.error("背景去除失败:",t),this.$message.error("背景去除服务调用失败。"),this.foregroundImage=null}},renderPhoto(){if(!this.foregroundImage)return;const e=this.$refs.photoCanvas,t=e.getContext("2d"),a=this.foregroundImage.naturalWidth,s=this.foregroundImage.naturalHeight;t.fillStyle=this.selectedColor,t.fillRect(0,0,this.canvasWidth,this.canvasHeight),t.drawImage(this.foregroundImage,0,0,a,s,this.offsetX,this.offsetY,a*this.scale,s*this.scale)},downloadPhoto(){if(!this.foregroundImage)return void this.$message.warning("请先上传并处理照片。");this.renderPhoto();const e=this.$refs.photoCanvas;e.toBlob((e=>{const t=URL.createObjectURL(e),a=document.createElement("a");a.href=t,a.download=`证件照_${this.selectedStandard.label}_${(new Date).getTime()}.jpeg`,document.body.appendChild(a),a.click(),document.body.removeChild(a),URL.revokeObjectURL(t)}),"image/jpeg",.95)},startDrag(e){this.foregroundImage&&(this.isDragging=!0,this.startX=e.clientX||e.touches[0].clientX,this.startY=e.clientY||e.touches[0].clientY,this.initialOffsetX=this.offsetX,this.initialOffsetY=this.offsetY,document.addEventListener("mousemove",this.onDrag),document.addEventListener("mouseup",this.stopDrag),document.addEventListener("touchmove",this.onDrag,{passive:!1}),document.addEventListener("touchend",this.stopDrag))},onDrag(e){if(!this.isDragging)return;e.preventDefault();const t=e.clientX||e.touches[0].clientX,a=e.clientY||e.touches[0].clientY,s=t-this.startX,o=a-this.startY;this.offsetX=this.initialOffsetX+s,this.offsetY=this.initialOffsetY+o,this.renderPhoto()},stopDrag(){this.isDragging=!1,document.removeEventListener("mousemove",this.onDrag),document.removeEventListener("mouseup",this.stopDrag),document.removeEventListener("touchmove",this.onDrag,{passive:!1}),document.removeEventListener("touchend",this.stopDrag)},handleZoom(e){if(!this.foregroundImage)return;const t=this.scale+e;t>.3&&t<5&&(this.scale=t,this.renderPhoto())},handleParamChange(){this.renderPhoto()}},watch:{selectedStandard:"handleParamChange",selectedColor:"handleParamChange",foregroundImage:"handleParamChange"}},l=r,d=a(81656),c=(0,d.A)(l,s,o,!1,null,"030c580b",null),h=c.exports}}]);
//# sourceMappingURL=1124.3f86d5bb.js.map