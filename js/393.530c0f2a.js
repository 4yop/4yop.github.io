"use strict";(self["webpackChunkweb_tool_vue"]=self["webpackChunkweb_tool_vue"]||[]).push([[393],{70393:function(t,e,a){a.r(e),a.d(e,{default:function(){return w}});var s=function(){var t=this,e=t._self._c;return e("div",{staticClass:"card-photo-container"},[e("el-card",{staticClass:"box-card",attrs:{"body-style":{padding:"0px"}}},[e("div",{staticClass:"top-controls"},[e("span",{staticClass:"control-label"},[t._v("证件要求:")]),e("el-select",{staticStyle:{width:"120px","margin-right":"10px"},attrs:{size:"small",disabled:t.saveIng},on:{change:t.changeStandard},model:{value:t.params.standard,callback:function(e){t.$set(t.params,"standard",e)},expression:"params.standard"}},t._l(t.standards,(function(t){return e("el-option",{key:t.label,attrs:{label:t.label,value:t.label}})})),1),e("span",{staticClass:"control-label"},[t._v("宽度:")]),e("el-input-number",{staticStyle:{width:"110px"},attrs:{min:100,size:"small",type:"number",disabled:t.saveIng},model:{value:t.params.width,callback:function(e){t.$set(t.params,"width",e)},expression:"params.width"}}),e("span",{staticClass:"unit"},[t._v("px")]),e("span",{staticClass:"control-label"},[t._v("高度:")]),e("el-input-number",{staticStyle:{width:"110px"},attrs:{min:100,size:"small",disabled:t.saveIng,type:"number"},model:{value:t.params.height,callback:function(e){t.$set(t.params,"height",e)},expression:"params.height"}}),e("span",{staticClass:"unit"},[t._v("px")]),e("span",{staticClass:"control-label"},[t._v("背景颜色:")]),e("el-select",{staticStyle:{width:"90px","margin-right":"10px"},attrs:{size:"small",disabled:t.saveIng},model:{value:t.params.background,callback:function(e){t.$set(t.params,"background",e)},expression:"params.background"}},t._l(t.backgrounds,(function(a){return e("el-option",{key:a.value,attrs:{label:a.label,value:a.value}},[e("span",{staticClass:"color-swatch",style:{background:a.value}}),t._v(" "+t._s(a.label)+" ")])})),1),e("el-button",{attrs:{type:"primary",size:"small",loading:t.imgInfo.snapping,disabled:t.imgInfo.snapping||!t.imgInfo.img||t.saveIng},on:{click:function(e){return t.removeBg()}}},[t._v(" "+t._s(t.imgInfo.snapping?"抠图中...":"开始抠图")+" ")])],1),e("div",{staticClass:"main-content-wrapper"},[e("el-row",{attrs:{gutter:0}},[e("el-col",{staticClass:"preview-area",attrs:{xs:24,sm:12}},[e("div",{staticClass:"canvas-wrapper"},[e("el-upload",{staticClass:"upload-overlay",attrs:{action:"#","show-file-list":!1,"auto-upload":!1,"on-change":t.handleUploadChange,accept:"image/*"}},[t.imgInfo.img?e("img",{staticClass:"original-image-preview",attrs:{src:t.imgInfo.img,alt:"Uploaded Original Image"}}):e("div",{staticClass:"upload-text"},[e("i",{staticClass:"el-icon-picture-outline"}),e("p",[t._v("点击选择图片")])])]),t._e()],1)]),e("el-col",{staticClass:"placeholder-area",attrs:{xs:24,sm:12}},[t.imgInfo.snapImg?e("div",[e("span",{staticClass:"control-label"},[t._v("宽:")]),e("el-input-number",{staticStyle:{width:"110px"},attrs:{size:"small",disabled:t.saveIng,type:"number"},on:{change:t.changeAfterWidth},model:{value:t.afterImgStyle.width,callback:function(e){t.$set(t.afterImgStyle,"width",e)},expression:"afterImgStyle.width"}}),e("span",{staticClass:"unit"},[t._v("px")]),e("span",{staticClass:"control-label"},[t._v("左:")]),e("el-input-number",{staticStyle:{width:"110px"},attrs:{size:"small",disabled:t.saveIng,type:"number"},model:{value:t.afterImgStyle.left,callback:function(e){t.$set(t.afterImgStyle,"left",e)},expression:"afterImgStyle.left"}}),e("span",{staticClass:"unit"},[t._v("px")]),e("span",{staticClass:"control-label"},[t._v("上:")]),e("el-input-number",{staticStyle:{width:"110px"},attrs:{size:"small",disabled:t.saveIng,type:"number"},model:{value:t.afterImgStyle.top,callback:function(e){t.$set(t.afterImgStyle,"top",e)},expression:"afterImgStyle.top"}}),e("span",{staticClass:"unit"},[t._v("px")]),e("el-button",{attrs:{type:"success",size:"small",loading:t.saveIng,disabled:t.saveIng},on:{click:function(e){return t.saveFile()}}},[t._v(" 另存为 ")])],1):t._e(),e("div",{staticStyle:{position:"relative",overflow:"hidden",display:"block",margin:"0",padding:"0"},style:{width:t.params.width+"px",height:t.params.height+"px",background:t.params.background},attrs:{id:"card-photo-container"}},[t.imgInfo.snapImg?e("img",{staticStyle:{position:"absolute",display:"block",margin:"0",padding:"0"},style:{width:t.afterImgStyle.width+"px",height:t.afterImgStyle.height+"px",top:t.afterImgStyle.top+"px",left:t.afterImgStyle.left+"px"},attrs:{src:t.imgInfo.snapImg,alt:"扣图后的"},on:{load:t.loadSnapImg}}):e("div",{staticClass:"info-text"},[e("p",[t._v("证件照标准信息和操作提示")]),e("p",[t._v("当前尺寸: "+t._s(t.params.width)+"x"+t._s(t.params.height)+" px")]),e("p",[t._v("当前背景: "+t._s(t.params.background))]),t.isPreloaded?t._e():e("p",{staticStyle:{color:"orange","font-weight":"bold"}},[t._v("模型正在后台加载...")]),t.imgInfo.snapping?e("div",[e("p",[t._v("用时:"+t._s((t.imgInfo.endTime-t.imgInfo.startTime)/1e3)+"秒")]),e("p",[t._v("说明:"+t._s(t.imgInfo.msg))]),t.imgInfo.imgError.length>0?e("p",[t._v("错误:"+t._s(t.imgInfo.imgError))]):t._e()]):t._e()])])])],1)],1),t._e()]),e("table",[t._m(0),t._l(t.loadModelProcess,(function(a,s){return e("tr",{key:s},[e("td",[t._v(t._s(a.key))]),e("td",[t._v(t._s(a.current))]),e("td",[t._v(t._s(a.total))]),e("td",[t._v(t._s(a.progress))])])}))],2)],1)},i=[function(){var t=this,e=t._self._c;return e("tr",[e("td",[t._v("模型")]),e("td",[t._v("已加载")]),e("td",[t._v("总")]),e("td",[t._v("进度")])])}];a(14603),a(47566),a(98721),a(16280);function l(t,e){if(e.has(t))throw new TypeError("Cannot initialize the same private elements twice on an object")}function n(t,e,a){l(t,e),e.set(t,a)}function r(t,e,a){if("function"==typeof t?t===e:t.has(e))return arguments.length<3?e:a;throw new TypeError("Private element is not present on this object")}function o(t,e,a){return t.set(r(t,e),a),a}function g(t,e){return t.get(r(t,e))}var c=a(75912),m=a(45492),d=new WeakMap,p=new WeakMap;class h{constructor(){n(this,d,{}),n(this,p,!1)}getProcess(){return g(d,this)}getIsPreloaded(){return g(p,this)}loadModel(){if(window.__PRERENDER_INJECTED__)return void o(p,this,!0);let t={debug:!0,proxyToWorker:!0,model:"small",output:{format:"image/png",quality:1,type:"foreground"},progress:(t,e,a)=>{void 0===g(d,this)[t]&&(g(d,this)[t]={key:t,current:0,total:0}),g(d,this)[t]={key:t,current:c.A.formatBytes(e),total:c.A.formatBytes(a),progress:100*e/a+"%"},console.log(`Downloading ${t}: ${e} of ${a}`)}};(0,m.uv)(t).then((()=>{o(p,this,!0),console.log("Background removal resources preloaded")}))}async removeBg(t){const e=await(0,m.Ay)(t);return{blob:e,url:URL.createObjectURL(e)}}async snap(t){try{if(null!==t.snapImg)return;if(t.imgError)return void(t.msg="选择的图片文件有误");if(!t.img)return void(t.msg="没上传");if(t.snapping)return;console.log(30),t.msg="扣图中...",t.snapping=!0,t.startTime=(new Date).getTime(),t.timer=setInterval((()=>{t.endTime=(new Date).getTime()}));const e=await(0,m.Ay)(t.img);t.timer=null,t.endTime=(new Date).getTime(),t.snapImg=URL.createObjectURL(e),t.snapImgFile=e,t.snapping=!1,t.msg="完成"}catch(e){t.msg=e.msg}finally{t.timer&&(clearInterval(t.timer),t.timer=null)}return t}}const u=new h;u.loadModel();var f=u,v=a(9789),I={name:"CardPhotoView",metaInfo:{title:"证件照生成工具"},data(){return{standards:[{label:"一寸 (295x413px)",width:295,height:413,ratio:1.4},{label:"二寸 (413x579px)",width:413,height:579,ratio:1.4}],backgrounds:[{label:"白底",value:"#ffffff"},{label:"蓝底",value:"#0070c0"},{label:"红底",value:"#d0021b"}],params:{standard:"一寸 (295x413px)",width:295,height:413,background:"#0070c0"},afterImgStyle:{source_width:0,source_height:0,width:0,height:0,top:0,left:0},loadModelProcess:{},isPreloaded:!1,saveIng:!1,imgInfo:{img:"",imgFile:null,snapImg:null,snapImgSize:0,snapImgFile:null,imgError:!1,startTime:(new Date).getTime(),endTime:(new Date).getTime(),timer:null,snapping:!1,msg:""}}},computed:{},mounted(){this.checkMatting()},methods:{changeAfterWidth(){const t=this.afterImgStyle.source_width/this.afterImgStyle.width;console.log(t),this.afterImgStyle.height=this.afterImgStyle.source_height/t,console.log("changeAfterWidth")},changeStandard(){for(const t of this.standards)if(this.params.standard===t.label){this.params.width=t.width,this.params.height=t.height;break}},loadSnapImg(t){const e=t.target,a=e.naturalWidth,s=e.naturalHeight;this.afterImgStyle.source_width=a,this.afterImgStyle.source_height=s,console.log(this.afterImgStyle);const i=this.afterImgStyle.source_width/this.params.width;this.afterImgStyle.height=this.afterImgStyle.source_height/i,this.afterImgStyle.width=this.params.width,this.afterImgStyle.top=this.params.height-this.afterImgStyle.height},async saveFile(){this.saveIng=!0;try{const t=await v.A.elementToImage("#card-photo-container");await c.A.download(t,"证件照.tool.4yop.com.png"),this.$message.success("保存成功")}catch(t){console.log(t),this.$message.error("出错:"+t.message)}finally{this.saveIng=!1}},async removeBg(){this.imgInfo=await f.snap(this.imgInfo),this.afterImgStyle={source_width:0,source_height:0,width:0,height:0,top:0,left:0}},handleUploadChange(t){const e=t.raw||t;if(!e.type.startsWith("image/"))return this.$alert("必须选择的是图片");if(e.type.startsWith("image/gif"))return this.$alert("不能用gif图");let a={img:URL.createObjectURL(e),imgFile:e,snapImg:null,snapImgSize:0,snapImgFile:null,imgError:!1,startTime:(new Date).getTime(),endTime:(new Date).getTime(),timer:null,snapping:!1,msg:""};this.imgInfo=a},checkMatting(){const t=setInterval((()=>{this.isPreloaded=f.getIsPreloaded(),this.loadModelProcess=f.getProcess(),this.isPreloaded&&clearInterval(t)}),3e3)}},watch:{}},y=I,b=a(81656),_=(0,b.A)(y,s,i,!1,null,"5fb57aae",null),w=_.exports}}]);
//# sourceMappingURL=393.530c0f2a.js.map