(function(){var e={54793:function(e,t,i){"use strict";var o=i(66848),s=function(){var e=this,t=e._self._c;return t("div",{staticClass:"modern-bg"},[t("el-row",{attrs:{gutter:0,justify:"center"}},[t("el-col",{attrs:{xs:{span:24,offset:0},sm:{span:22,offset:1},md:{span:18,offset:3},lg:{span:14,offset:5},xl:{span:12,offset:6}}},[t("el-card",{staticClass:"modern-card",attrs:{shadow:"hover"}},[t("div",{staticStyle:{color:"#f56c6c","font-size":"16px","margin-bottom":"12px","text-align":"center"}},[e._v(" è¦ç­‰æ¨¡å‹åŠ è½½;æ‰§è¡Œé«˜æ¸…åŒ–è¦å¾ˆä¹…ï¼Œæ…¢æ…¢ç­‰å§; ")]),e.webglNotSupported?t("div",{staticStyle:{color:"#f56c6c","font-size":"16px","margin-bottom":"12px","text-align":"center"}},[e._v(" å½“å‰æµè§ˆå™¨æˆ–æ˜¾å¡ä¸æ”¯æŒ WebGLï¼Œæ— æ³•ä½¿ç”¨é«˜æ¸…åŒ–åŠŸèƒ½ï¼Œè¯·æ›´æ¢è®¾å¤‡æˆ–æµè§ˆå™¨ã€‚ ")]):e._e(),e.webglNotSupported?e._e():t("div",{staticClass:"tile-settings"},[t("div",{staticClass:"setting-row"},[t("span",{staticClass:"setting-label"},[e._v("ğŸ§© åˆ†ç‰‡å¤§å°ï¼š")]),t("el-input-number",{staticStyle:{width:"120px","margin-right":"8px"},attrs:{min:100,max:500,step:10,size:"small",disabled:e.isProcessing()||e.loadingModel||e.aiFailed},model:{value:e.tileWidth,callback:function(t){e.tileWidth=t},expression:"tileWidth"}}),t("span",{staticStyle:{margin:"0 4px"}},[e._v("Ã—")]),t("el-input-number",{staticStyle:{width:"120px","margin-right":"8px"},attrs:{min:100,max:500,step:10,size:"small",disabled:e.isProcessing()||e.loadingModel||e.aiFailed},model:{value:e.tileHeight,callback:function(t){e.tileHeight=t},expression:"tileHeight"}}),t("span",{staticClass:"setting-hint"},[e._v("åƒç´  (é»˜è®¤100Ã—100ï¼Œè¶Šå°å¤„ç†è¶Šæ…¢ä½†å†…å­˜å ç”¨è¶Šå°‘,æ˜¾å¡å¥½çš„å°±è°ƒå¤§äº›)")])],1),t("div",{staticClass:"setting-row"},[t("span",{staticClass:"setting-label"},[e._v("ğŸ”„ é‡è¯•è®¾ç½®ï¼š")]),t("el-input-number",{staticStyle:{width:"120px","margin-right":"8px"},attrs:{min:1,max:5,size:"small",disabled:e.isProcessing()||e.loadingModel||e.aiFailed},model:{value:e.maxRetries,callback:function(t){e.maxRetries=t},expression:"maxRetries"}}),t("span",{staticClass:"setting-hint"},[e._v("æ¬¡ (åˆ†ç‰‡å¤±è´¥æ—¶çš„æœ€å¤§é‡è¯•æ¬¡æ•°)")])],1)]),t("div",{staticClass:"upload-row"},[e.webglNotSupported?e._e():[t("el-upload",{ref:"uploadRef",attrs:{action:"#","auto-upload":!1,multiple:!0,"show-file-list":!1,accept:"image/*",disabled:e.isProcessing()||e.loadingModel||e.aiFailed,"on-change":e.handleUploadChange}},[t("el-button",{attrs:{type:"primary",round:"",disabled:e.isProcessing()||e.loadingModel||e.aiFailed}},[e._v("é€‰æ‹©å›¾ç‰‡")])],1),t("el-button",{attrs:{type:"success",round:"",disabled:e.isProcessing()||0===e.imgs.length||e.loadingModel||e.aiFailed},on:{click:e.upscaleMany}},[e._v("é«˜æ¸…åŒ–")]),t("el-button",{attrs:{size:"mini",disabled:e.aiFailed},on:{click:function(t){return e.$refs.imgTable.clearSelection()}}},[e._v("å…¨ä¸é€‰")]),t("el-button",{attrs:{type:"danger",size:"mini",disabled:0===e.multipleSelection.length||e.aiFailed},on:{click:e.handleBatchDelete}},[e._v("æ‰¹é‡åˆ é™¤")]),t("el-button",{attrs:{type:"warning",size:"mini",disabled:0===e.imgs.filter((e=>e.upscaleImgFile)).length||e.aiFailed},on:{click:e.handleDownloadZip}},[e._v("æ‰“åŒ…ä¸‹è½½")])]],2),t("div",{staticStyle:{"margin-top":"24px"}},[t("el-table",{ref:"imgTable",staticStyle:{width:"100%","max-width":"900px",margin:"0 auto"},attrs:{data:e.imgs,border:""}},[t("el-table-column",{attrs:{type:"selection",width:"50"}}),t("el-table-column",{attrs:{label:"åŸå›¾",align:"center"},scopedSlots:e._u([{key:"default",fn:function(i){return[i.row.img?t("el-image",{staticStyle:{width:"120px","border-radius":"10px","box-shadow":"0 2px 8px rgba(0,0,0,0.08)"},attrs:{src:i.row.img,alt:i.row.imgFile.name,"preview-src-list":e.imgs.map((e=>e.img))},on:{error:function(e){i.row.imgError=!0,i.row.msg="å›¾ç‰‡æ–‡ä»¶æœ‰è¯¯;"}}}):e._e(),i.row.imgFile?t("p",{staticClass:"img-info"},[e._v("å¤§å°:"+e._s(e.formatFileSize(i.row.imgFile.size)))]):e._e()]}}])}),t("el-table-column",{attrs:{label:"é«˜æ¸…ç»“æœ",align:"center"},scopedSlots:e._u([{key:"default",fn:function(i){return[i.row.upscaleImg?t("div",[t("el-image",{staticStyle:{width:"120px","border-radius":"10px","box-shadow":"0 2px 8px rgba(0,0,0,0.08)",background:"#f0f9eb"},attrs:{alt:"é«˜æ¸…åçš„"+i.row.imgFile.name,src:i.row.upscaleImg,"preview-src-list":e.imgs.map((e=>e.upscaleImg)).filter(Boolean)}}),i.row.processing?t("div",{staticStyle:{"font-size":"11px",color:"#E6A23C",margin:"3px 0"}},[e._v(" ğŸ¨ å®æ—¶ç”Ÿæˆä¸­... ")]):e._e(),!i.row.processing&&i.row.upscaleImgFile?t("el-button",{staticStyle:{"margin-top":"5px"},attrs:{type:"primary",size:"mini"},on:{click:function(t){return e.downloadImg(i.row)}}},[t("i",{staticClass:"el-icon-download"}),e._v(" ä¸‹è½½ ")]):e._e(),i.row.upscaleImgFile?t("p",{staticClass:"img-info"},[e._v("å¤§å°:"+e._s(e.formatFileSize(i.row.upscaleImgFile.size)))]):e._e()],1):i.row.processing?t("div",{staticStyle:{color:"#E6A23C","font-size":"12px"}},[e._v(" ğŸ”„ å‡†å¤‡ç”Ÿæˆ... ")]):t("div",{staticStyle:{color:"#999","font-size":"12px"}},[e._v(" ç­‰å¾…å¤„ç†... ")])]}}])}),t("el-table-column",{attrs:{label:"è¯´æ˜",align:"center",width:"300"},scopedSlots:e._u([{key:"default",fn:function(i){return[t("div",{staticStyle:{"text-align":"center"}},[t("h3",{staticStyle:{color:"#409EFF",margin:"5px 0","font-size":"14px"}},[e._v(e._s(i.row.msg))]),i.row.processing&&i.row.totalTiles>1?t("div",{staticStyle:{"font-size":"12px",color:"#E6A23C",margin:"5px 0"}},[e._v(" ğŸ“¦ åˆ†ç‰‡ä¿¡æ¯: æ€»å…±"+e._s(i.row.totalTiles)+"ç‰‡ï¼Œå½“å‰ç¬¬"+e._s(i.row.currentTile)+"ç‰‡ "),t("br"),e._v(" ğŸ¯ å½“å‰åˆ†ç‰‡: ["+e._s(i.row.currentTileX)+","+e._s(i.row.currentTileY)+"] ")]):e._e(),i.row.processing&&i.row.progress>=0?t("div",[t("el-progress",{staticStyle:{margin:"8px 0"},attrs:{percentage:i.row.progress,"stroke-width":12,"text-inside":!0,status:100===i.row.progress?"success":null,color:100===i.row.progress?"#67C23A":"#409EFF"}}),t("div",{staticStyle:{"font-size":"12px",color:"#666","margin-top":"5px"}},[i.row.startTime?t("span",[e._v(" å·²ç”¨æ—¶: "+e._s(Math.floor(((new Date).getTime()-i.row.startTime)/1e3))+"ç§’ ")]):e._e()])],1):e._e(),i.row.upscaleImg&&i.row.endTime&&i.row.startTime?t("div",{staticStyle:{"font-size":"12px",color:"#67C23A","margin-top":"5px"}},[e._v(" âœ… æ€»ç”¨æ—¶: "+e._s(Math.floor((i.row.endTime-i.row.startTime)/1e3))+"ç§’ ")]):i.row.processing&&i.row.startTime?t("div",{staticStyle:{"font-size":"12px",color:"#E6A23C","margin-top":"5px"}},[e._v(" â±ï¸ å¤„ç†ä¸­: "+e._s(Math.floor(((new Date).getTime()-i.row.startTime)/1e3))+"ç§’ ")]):e._e()])]}}])}),t("el-table-column",{attrs:{label:"æ“ä½œ",align:"center",width:"90"},scopedSlots:e._u([{key:"default",fn:function(i){return[t("el-button",{attrs:{type:"danger",size:"mini"},on:{click:function(t){return e.handleDeleteRow(i.$index)}}},[e._v("åˆ é™¤")])]}}])})],1)],1)])],1)],1),t("el-row",{attrs:{gutter:0,justify:"center"}},[t("el-col",{attrs:{xs:{span:24,offset:0},sm:{span:22,offset:1},md:{span:18,offset:3},lg:{span:14,offset:5},xl:{span:12,offset:6}}},[t("el-card",{staticClass:"modern-card",attrs:{shadow:"hover"}},[t("h3",{staticClass:"modern-title"},[e._v("æ¨¡å‹åŠ è½½è¿›åº¦("+e._s(e.modelLoaded?"å·²åŠ è½½":"åŠ è½½ä¸­")+")")]),t("el-divider"),t("el-table",{staticStyle:{width:"100%","max-width":"900px",margin:"0 auto"},attrs:{data:[e.modelProgress],border:""}},[t("el-table-column",{attrs:{label:"æ¨¡å‹",prop:"key",align:"center"}}),t("el-table-column",{attrs:{label:"çŠ¶æ€",prop:"current",align:"center"}}),t("el-table-column",{attrs:{label:"è¿›åº¦",prop:"progress",align:"center"}})],1)],1)],1)],1)],1)},l=[],n=(i(44114),i(14603),i(47566),i(98721),i(97244)),r=i(75912),a={name:"UpscaleView",metaInfo:{title:"åœ¨çº¿å›¾ç‰‡é«˜æ¸…åŒ–å·¥å…· - AIæ”¾å¤§ä¸æ¨¡ç³Š",meta:[{name:"description",content:"ä¸Šä¼ æ¨¡ç³Šå›¾ç‰‡åï¼Œåˆ©ç”¨ AI æŠ€æœ¯æ— æŸæ”¾å¤§ï¼Œæå‡æ¸…æ™°åº¦ï¼Œé€‚åˆå¤´åƒã€æ’ç”»ã€äº§å“å›¾ç­‰åœºæ™¯ã€‚"},{name:"keywords",content:"å›¾ç‰‡å˜æ¸…æ™°,AIæ”¾å¤§å›¾ç‰‡,åœ¨çº¿é«˜æ¸…åŒ–,å›¾ç‰‡å¢å¼º,å›¾åƒæ”¾å¤§å·¥å…·"}]},data(){return{imgs:[],multipleSelection:[],upscaler:null,loadingModel:!1,modelLoaded:!1,modelProgress:{key:"UpscalerJSæ¨¡å‹",current:"",total:"",progress:""},webglNotSupported:!1,aiFailed:!1,tileWidth:100,tileHeight:100,maxRetries:3}},async mounted(){if(!window.__PRERENDER_INJECTED__&&(this.webglNotSupported=!(window.WebGLRenderingContext&&document.createElement("canvas").getContext("webgl")),!this.webglNotSupported)){this.setupWebGLContextListeners(),this.loadingModel=!0,this.modelProgress.current="åŠ è½½ä¸­",this.modelProgress.total="",this.modelProgress.progress="0";try{this.upscaler=new n.Ay,!1===this.webglNotSupported&&await this.upscaler.upscale(document.createElement("canvas")),this.modelLoaded=!0,this.modelProgress.current="å·²åŠ è½½",this.modelProgress.progress="100"}catch(e){console.error("æ¨¡å‹åŠ è½½å¤±è´¥:",e),this.webglNotSupported=!0}finally{this.loadingModel=!1}}},methods:{formatFileSize(e){if(0===e)return"0 B";const t={TB:Math.pow(1024,4),GB:Math.pow(1024,3),MB:Math.pow(1024,2),KB:1024,B:1};function i(e){for(let i in t)if(e>=t[i])return i}const o=i(e),s=Math.round(e/t[o]*100)/100;return`${s} ${o}`},handleUploadChange(e,t){this.imgs=[];for(const i of t){const e=i.raw||i;let t={img:URL.createObjectURL(e),imgFile:e,upscaleImg:null,upscaleImgFile:null,imgError:!1,startTime:null,endTime:null,processing:!1,msg:"",progress:0,currentTile:0,totalTiles:0,currentTileX:0,currentTileY:0};e.type&&e.type.startsWith("image/gif")&&(t.imgError=!0,t.msg="gifä¸èƒ½ç”¨"),this.imgs.push(t)}},isProcessing(){return this.imgs.some((e=>e.processing))},async upscaleMany(){console.log(`ğŸš€ å¼€å§‹ä¸²è¡Œå¤„ç†${this.imgs.length}å¼ å›¾ç‰‡ï¼Œä¸€å¼ å¼ å¤„ç†ï¼`);for(let t=0;t<this.imgs.length;t++){const i=this.imgs[t];if(i.upscaleImg||i.processing)console.log(`â­ï¸ è·³è¿‡ç¬¬${t+1}/${this.imgs.length}å¼ å›¾ç‰‡: ${i.imgFile.name} (å·²å¤„ç†æˆ–æ­£åœ¨å¤„ç†)`);else{console.log(`ğŸ“‹ å¼€å§‹å¤„ç†ç¬¬${t+1}/${this.imgs.length}å¼ å›¾ç‰‡: ${i.imgFile.name}`);try{await this.upscale(i),console.log(`âœ… ç¬¬${t+1}/${this.imgs.length}å¼ å›¾ç‰‡å¤„ç†å®Œæˆ: ${i.imgFile.name}`)}catch(e){console.error(`âŒ ç¬¬${t+1}/${this.imgs.length}å¼ å›¾ç‰‡å¤„ç†å¤±è´¥: ${i.imgFile.name}`,e),i.msg="å¤„ç†å¤±è´¥: "+e.message,i.processing=!1}t<this.imgs.length-1&&(console.log("â³ ç­‰å¾…1ç§’åå¤„ç†ä¸‹ä¸€å¼ å›¾ç‰‡..."),await new Promise((e=>setTimeout(e,1e3))))}}console.log(`ğŸ‰ æ‰€æœ‰${this.imgs.length}å¼ å›¾ç‰‡å¤„ç†å®Œæˆï¼`)},async upscale(e){try{if(null!==e.upscaleImg)return;if(e.imgError)return void(e.msg="é€‰æ‹©çš„å›¾ç‰‡æ–‡ä»¶æœ‰è¯¯");if(!e.img)return void(e.msg="æ²¡ä¸Šä¼ ");if(e.processing)return;e.msg="é«˜æ¸…å¤„ç†ä¸­...",e.processing=!0,e.progress=0,e.startTime=(new Date).getTime(),console.log(`ğŸ¯ å¼€å§‹å¤„ç†å›¾ç‰‡: ${e.imgFile.name}`);const t=new window.Image;t.src=e.img,await new Promise(((e,i)=>{t.onload=e,t.onerror=i})),console.log(`ğŸ“· å›¾ç‰‡åŠ è½½å®Œæˆ: ${t.width}x${t.height}`);const{tileWidth:i,tileHeight:o,needTiling:s,warning:l}=this.calculateOptimalTileSize(t.width,t.height);console.log("ğŸ¤– æ™ºèƒ½åˆ†å—åˆ¤æ–­:"),console.log(`   å›¾ç‰‡å°ºå¯¸: ${t.width}x${t.height}`),console.log("   æ˜¯å¦éœ€è¦åˆ†å—: "+(s?"æ˜¯":"å¦")),console.log(`   åˆ†å—å°ºå¯¸: ${i}x${o}`),l&&(console.log(`âš ï¸ è­¦å‘Š: ${l}`),this.$message.warning(l)),s?(console.log("ğŸ“¦ é€‰æ‹©å¤§å›¾åˆ†å—å¤„ç†æ¨¡å¼"),await this.processLargeImage(t,e,i,o),console.log(`ğŸ‰ å¤§å›¾åˆ†å—å¤„ç†å®Œæˆ: ${e.imgFile.name}`)):(console.log("ğŸ–¼ï¸ é€‰æ‹©å°å›¾ç›´æ¥å¤„ç†æ¨¡å¼"),await this.processSmallImage(t,e),console.log(`ğŸ‰ å°å›¾å¤„ç†å®Œæˆ: ${e.imgFile.name}`))}catch(t){throw console.error(`âŒ å›¾ç‰‡å¤„ç†é”™è¯¯: ${e.imgFile.name}`,t),e.upscaleImg&&URL.revokeObjectURL(e.upscaleImg),e.upscaleImg=null,e.upscaleImgFile=null,e.processing=!1,t.message.includes("å›¾ç‰‡å°ºå¯¸è¿‡å¤§")?(e.msg="å›¾ç‰‡å°ºå¯¸è¿‡å¤§ï¼Œè¯·ä½¿ç”¨æ›´å°çš„å›¾ç‰‡",this.$message.error("å›¾ç‰‡å°ºå¯¸è¿‡å¤§ï¼Œè¯·ä½¿ç”¨å°äº1024x1024çš„å›¾ç‰‡ï¼")):t.message.includes("WebGL")||t.message.includes("shader")||t.message.includes("context")?(this.webglNotSupported=!0,this.aiFailed=!0,e.msg="WebGLé”™è¯¯ï¼šGPUæ€§èƒ½ä¸è¶³",this.$message.error("WebGLé”™è¯¯ï¼šGPUæ€§èƒ½ä¸è¶³æˆ–æ˜¾å¡é©±åŠ¨é—®é¢˜ï¼Œè¯·åˆ·æ–°é¡µé¢æˆ–æ›´æ¢è®¾å¤‡ï¼")):(e.msg="é«˜æ¸…åŒ–å¤±è´¥ï¼šè®¾å¤‡æ€§èƒ½ä¸è¶³æˆ–å›¾ç‰‡è¿‡å¤§",this.aiFailed=!0,this.$message.error("é«˜æ¸…åŒ–å¤±è´¥ï¼šè®¾å¤‡æ€§èƒ½ä¸è¶³æˆ–å›¾ç‰‡è¿‡å¤§ï¼Œè¯·å°è¯•æ›´æ¢è®¾å¤‡æˆ–ç¼©å°å›¾ç‰‡å°ºå¯¸ï¼")),window.gc&&window.gc(),t}},handleSelectionChange(e){this.multipleSelection=e},handleDeleteRow(e){const t=this.imgs[e];if(this.$refs.uploadRef){const e=this.$refs.uploadRef.uploadFiles.find((e=>e.raw===t.imgFile));e&&this.$refs.uploadRef.handleRemove(e)}t.upscaleImg&&URL.revokeObjectURL(t.upscaleImg),this.imgs.splice(e,1),window.gc&&window.gc()},handleBatchDelete(){this.multipleSelection.forEach((e=>{if(e.img&&URL.revokeObjectURL(e.img),e.upscaleImg&&URL.revokeObjectURL(e.upscaleImg),this.$refs.uploadRef){const t=this.$refs.uploadRef.uploadFiles.find((t=>t.raw===e.imgFile));t&&this.$refs.uploadRef.handleRemove(t)}})),this.imgs=this.imgs.filter((e=>!this.multipleSelection.includes(e))),this.multipleSelection=[],this.$refs.imgTable&&this.$refs.imgTable.clearSelection(),window.gc&&window.gc()},calculateOptimalTileSize(e,t){const i=e*t,o=(i/1048576).toFixed(1);let s=null;const l=this.tileWidth,n=this.tileHeight,r=Math.ceil(e/l),a=Math.ceil(t/n),c=r*a;return c>1e4?s=`æ£€æµ‹åˆ°${o}MPå·¨å¤§å›¾ï¼Œå°†åˆ†ä¸º${c}å—å¤„ç†ï¼Œå¤„ç†æ—¶é—´æé•¿ï¼`:c>5e3?s=`æ£€æµ‹åˆ°${o}MPè¶…å¤§å›¾ï¼Œå°†åˆ†ä¸º${c}å—å¤„ç†ï¼Œå¤„ç†æ—¶é—´å¾ˆé•¿ï¼`:c>1e3?s=`æ£€æµ‹åˆ°${o}MPå¤§å›¾ï¼Œå°†åˆ†ä¸º${c}å—å¤„ç†ï¼Œé¢„è®¡éœ€è¦è¾ƒé•¿æ—¶é—´`:c>100&&(s=`æ£€æµ‹åˆ°${o}MPå›¾ç‰‡ï¼Œå°†åˆ†ä¸º${c}å—å¤„ç†`),console.log("ğŸ“ è‡ªå®šä¹‰åˆ†å—è®¡ç®—:"),console.log(`   å›¾ç‰‡å°ºå¯¸: ${e}x${t}`),console.log(`   åˆ†å—å°ºå¯¸: ${l}x${n} (ç”¨æˆ·è®¾ç½®)`),console.log(`   åˆ†å—æ•°é‡: ${r}x${a} = ${c}å—`),console.log("   æ‰€æœ‰å›¾ç‰‡éƒ½åˆ†å—å¤„ç†ï¼"),{tileWidth:l,tileHeight:n,needTiling:!0,warning:s}},async processSmallImage(e,t){console.log("ğŸ“Š å°å›¾ç›´æ¥å¤„ç†:"),console.log(`   å›¾ç‰‡å°ºå¯¸: ${e.width}x${e.height}`),console.log("   å¤„ç†æ–¹å¼: ç›´æ¥é«˜æ¸…åŒ–"),t.progress=10,t.msg="å°å›¾é«˜æ¸…åŒ–å¤„ç†ä¸­...",console.log("âš¡ å¼€å§‹å°å›¾é«˜æ¸…åŒ–..."),t.progress=50;const i=await this.upscaler.upscale(e);console.log("âœ… å°å›¾é«˜æ¸…åŒ–å®Œæˆ"),t.progress=80,t.upscaleImg=i;const o=await fetch(i),s=await o.blob();t.upscaleImgFile=s,t.endTime=(new Date).getTime(),t.processing=!1,t.progress=100,t.msg="å®Œæˆ",console.log(`ğŸ‰ å°å›¾å¤„ç†å®Œæˆï¼Œæ€»ç”¨æ—¶: ${Math.floor((t.endTime-t.startTime)/1e3)}ç§’`)},async processLargeImage(e,t,i,o){const{width:s,height:l}=e,n=2,r=Math.ceil(s/i),a=Math.ceil(l/o),c=r*a,g=Math.ceil(3*c/60);t.msg=`ğŸš€ ${i}x${o}åˆ†å—å¤„ç† (${r}x${a}=${c}å—, é¢„è®¡${g}åˆ†é’Ÿ)`,t.progress=0,t.startTime=(new Date).getTime(),t.totalTiles=c,t.currentTile=0,console.log(`ğŸ“Š å¼€å§‹${i}x${o}åˆ†å—å¤„ç†:`),console.log(`   å›¾ç‰‡å°ºå¯¸: ${s}x${l}`),console.log(`   åˆ†å—å°ºå¯¸: ${i}x${o} (ç”¨æˆ·è®¾ç½®)`),console.log(`   åˆ†å—æ•°é‡: ${r}x${a} = ${c}å—`),console.log(`   é¢„è®¡æ—¶é—´: ${g}åˆ†é’Ÿ`),console.log(`   æœ€å¤§é‡è¯•æ¬¡æ•°: ${this.maxRetries}æ¬¡`),console.log("   è¿›åº¦è®¡ç®—: å½“å‰åˆ†ç‰‡/æ€»åˆ†ç‰‡æ•°é‡");const m=document.createElement("canvas");m.width=s*n,m.height=l*n;const d=m.getContext("2d");let u=0;for(let h=0;h<a;h++)for(let a=0;a<r;a++){const r=a*i,g=h*o,f=Math.min(i,s-r),w=Math.min(o,l-g);console.log(`ğŸ” åˆ‡å‡ºç¬¬${u+1}ç‰‡å°å›¾ [${a+1},${h+1}]:`),console.log(`   ä½ç½®: (${r}, ${g})`),console.log(`   å°ºå¯¸: ${f}x${w}`),console.log(`   èŒƒå›´: X[${r}-${r+f}], Y[${g}-${g+w}]`);const $=document.createElement("canvas");$.width=f,$.height=w;const b=$.getContext("2d");b.drawImage(e,r,g,f,w,0,0,f,w);let v=0,x=null,y=!1;while(v<this.maxRetries&&!y)try{const e=v>0?` (é‡è¯•${v}/${this.maxRetries})`:"";console.log(`âš¡ å¼€å§‹é«˜æ¸…åŒ–ç¬¬${u+1}ç‰‡å°å›¾[${a+1},${h+1}]${e}...`),x=await this.upscaler.upscale($),y=!0,v>0&&console.log(`âœ… ç¬¬${u+1}ç‰‡å°å›¾é‡è¯•${v}æ¬¡åæˆåŠŸ`)}catch(p){if(v++,console.error(`âŒ ç¬¬${u+1}ç‰‡å°å›¾å¤„ç†å¤±è´¥ (å°è¯•${v}/${this.maxRetries}):`,p.message),!(v<this.maxRetries)){console.error(`ğŸ’¥ ç¬¬${u+1}ç‰‡å°å›¾é‡è¯•${this.maxRetries}æ¬¡åä»ç„¶å¤±è´¥ï¼Œè·³è¿‡æ­¤åˆ†ç‰‡`);break}console.log(`ğŸ”„ å‡†å¤‡é‡è¯•ç¬¬${u+1}ç‰‡å°å›¾...`),await new Promise((e=>setTimeout(e,1e3)))}if(y&&x)try{const e=new Image;await new Promise(((t,i)=>{e.onload=t,e.onerror=i,e.src=x})),console.log(`âœ… ç¬¬${u+1}ç‰‡å°å›¾é«˜æ¸…åŒ–å®Œæˆ:`),console.log(`   åŸå§‹å°ºå¯¸: ${f}x${w}`),console.log(`   é«˜æ¸…å°ºå¯¸: ${e.width}x${e.height}`),console.log(`   æ”¾å¤§å€æ•°: ${(e.width/f).toFixed(1)}x`),console.log(`ğŸ”— åˆå¹¶ç¬¬${u+1}ç‰‡åˆ°ç»“æœå›¾...`),d.drawImage(e,r*n,g*n,f*n,w*n);const i=m.toDataURL("image/jpeg",.9);t.upscaleImg=i,console.log(`ğŸ¨ å®æ—¶æ˜¾ç¤º: å·²å®Œæˆ${u+1}/${c}ç‰‡çš„ç»“æœå›¾`),console.log(`ğŸ—‘ï¸ é‡Šæ”¾ç¬¬${u+1}ç‰‡å°å›¾èµ„æº`),$.width=0,$.height=0,e.src=""}catch(p){console.error(`åˆå¹¶ç¬¬${u+1}ç‰‡æ—¶å‡ºé”™:`,p),d.drawImage(e,r,g,f,w,r*n,g*n,f*n,w*n)}else console.log(`âš ï¸ ç¬¬${u+1}ç‰‡å¤„ç†å¤±è´¥ï¼Œä½¿ç”¨åŸå›¾æ›¿ä»£`),d.drawImage(e,r,g,f,w,r*n,g*n,f*n,w*n);u++,t.progress=Math.round(u/c*100);const _=(new Date).getTime(),F=(_-t.startTime)/1e3,S=F/u,T=c-u,I=Math.ceil(T*S/60),R=a+1,M=h+1;t.msg=`ğŸ”„ å¤„ç†åˆ†ç‰‡[${R},${M}] ç¬¬${u}/${c}å— (${t.progress}%) å‰©ä½™${I}åˆ†é’Ÿ`,t.currentTile=u,t.totalTiles=c,t.currentTileX=R,t.currentTileY=M,console.log(`ğŸ”„ æ­£åœ¨å¤„ç†: ç¬¬${u}å—/${c}å— - åˆ†ç‰‡[${R},${M}] - å°ºå¯¸${f}x${w} - è¿›åº¦${t.progress}% (${u}/${c}) - å‰©ä½™${I}åˆ†é’Ÿ`),await new Promise((e=>setTimeout(e,10))),u%4===0&&window.gc&&window.gc()}m.toBlob((e=>{t.upscaleImg=URL.createObjectURL(e),t.upscaleImgFile=e,t.endTime=(new Date).getTime(),t.processing=!1,t.progress=100,t.msg="å®Œæˆ",m.width=0,m.height=0}),"image/png")},setupWebGLContextListeners(){window.addEventListener("webglcontextlost",(e=>{e.preventDefault(),console.warn("WebGLä¸Šä¸‹æ–‡ä¸¢å¤±ï¼Œç¦ç”¨AIé«˜æ¸…åŒ–åŠŸèƒ½"),this.webglNotSupported=!0,this.aiFailed=!0,this.$message.error("GPUå†…å­˜ä¸è¶³å¯¼è‡´WebGLä¸Šä¸‹æ–‡ä¸¢å¤±ï¼Œè¯·åˆ·æ–°é¡µé¢ï¼")})),window.addEventListener("webglcontextrestored",(()=>{console.log("WebGLä¸Šä¸‹æ–‡å·²æ¢å¤"),this.$message.info("WebGLä¸Šä¸‹æ–‡å·²æ¢å¤ï¼Œå»ºè®®åˆ·æ–°é¡µé¢é‡æ–°åˆå§‹åŒ–")}))},async downloadImg(e){if(!e.upscaleImgFile||!e.imgFile)return void this.$message.warning("å›¾ç‰‡è¿˜æœªå¤„ç†å®Œæˆï¼");const t=e.imgFile.name.replace(/\.[^.]+$/,"")+"_hd.png";await r.A.downloadFile(e.upscaleImgFile,t)},async handleDownloadZip(){const e=this.imgs.filter((e=>e.upscaleImgFile&&e.imgFile&&e.imgFile.name)).map((e=>({file:e.upscaleImgFile,save_name:e.imgFile.name.replace(/\.[^.]+$/,"")+"_hd.png"})));0!==e.length?await r.A.downloadAsZip(e,`upscale_${Date.now()}.zip`,"file","save_name"):this.$message.warning("æ²¡æœ‰å¯æ‰“åŒ…çš„é«˜æ¸…å›¾ç‰‡ï¼")}},beforeDestroy(){this.imgs.forEach((e=>{e.upscaleImg&&URL.revokeObjectURL(e.upscaleImg)})),this.upscaler&&this.upscaler.terminate&&this.upscaler.terminate(),window.gc&&window.gc()}},c=a,g=i(81656),m=(0,g.A)(c,s,l,!1,null,"2f8eac93",null),d=m.exports,u=i(89143),p=i.n(u);o["default"].config.productionTip=!1,o["default"].use(p()),new o["default"]({render:e=>e(d),mounted(){document.dispatchEvent(new Event("render-event"))}}).$mount("#app")},85817:function(){},18590:function(){},4530:function(){},8108:function(){},80551:function(){},41234:function(){}},t={};function i(o){var s=t[o];if(void 0!==s)return s.exports;var l=t[o]={id:o,loaded:!1,exports:{}};return e[o].call(l.exports,l,l.exports,i),l.loaded=!0,l.exports}i.m=e,function(){i.amdD=function(){throw new Error("define cannot be used indirect")}}(),function(){i.amdO={}}(),function(){var e=[];i.O=function(t,o,s,l){if(!o){var n=1/0;for(g=0;g<e.length;g++){o=e[g][0],s=e[g][1],l=e[g][2];for(var r=!0,a=0;a<o.length;a++)(!1&l||n>=l)&&Object.keys(i.O).every((function(e){return i.O[e](o[a])}))?o.splice(a--,1):(r=!1,l<n&&(n=l));if(r){e.splice(g--,1);var c=s();void 0!==c&&(t=c)}}return t}l=l||0;for(var g=e.length;g>0&&e[g-1][2]>l;g--)e[g]=e[g-1];e[g]=[o,s,l]}}(),function(){i.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return i.d(t,{a:t}),t}}(),function(){var e,t=Object.getPrototypeOf?function(e){return Object.getPrototypeOf(e)}:function(e){return e.__proto__};i.t=function(o,s){if(1&s&&(o=this(o)),8&s)return o;if("object"===typeof o&&o){if(4&s&&o.__esModule)return o;if(16&s&&"function"===typeof o.then)return o}var l=Object.create(null);i.r(l);var n={};e=e||[null,t({}),t([]),t(t)];for(var r=2&s&&o;"object"==typeof r&&!~e.indexOf(r);r=t(r))Object.getOwnPropertyNames(r).forEach((function(e){n[e]=function(){return o[e]}}));return n["default"]=function(){return o},i.d(l,n),l}}(),function(){i.d=function(e,t){for(var o in t)i.o(t,o)&&!i.o(e,o)&&Object.defineProperty(e,o,{enumerable:!0,get:t[o]})}}(),function(){i.e=function(){return Promise.resolve()}}(),function(){i.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"===typeof window)return window}}()}(),function(){i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)}}(),function(){i.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})}}(),function(){i.nmd=function(e){return e.paths=[],e.children||(e.children=[]),e}}(),function(){i.j=7625}(),function(){var e={7625:0};i.O.j=function(t){return 0===e[t]};var t=function(t,o){var s,l,n=o[0],r=o[1],a=o[2],c=0;if(n.some((function(t){return 0!==e[t]}))){for(s in r)i.o(r,s)&&(i.m[s]=r[s]);if(a)var g=a(i)}for(t&&t(o);c<n.length;c++)l=n[c],i.o(e,l)&&e[l]&&e[l][0](),e[l]=0;return i.O(g)},o=self["webpackChunkweb_tool_vue"]=self["webpackChunkweb_tool_vue"]||[];o.forEach(t.bind(null,0)),o.push=t.bind(null,o.push.bind(o))}();var o=i.O(void 0,[504,996],(function(){return i(54793)}));o=i.O(o)})();