(function(){"use strict";var t={12332:function(t,e,i){var s=i(66848),n=function(){var t=this,e=t._self._c;return e("section",{attrs:{id:"m-app"}},[e("section",{staticClass:"m-p-action g-box"},[t._v(t._s(t.tips))]),e("div",{staticClass:"m-p-temp-url"},[t._v("测试链接：https://upyun.luckly-mjw.cn/Assets/media-source/example/media/index.m3u8")]),e("section",{staticClass:"m-p-input-container"},[e("input",{directives:[{name:"model",rawName:"v-model",value:t.task.url,expression:"task.url"}],attrs:{type:"text",placeholder:"请输入 m3u8 链接"},domProps:{value:t.task.url},on:{input:function(e){e.target.composing||t.$set(t.task,"url",e.target.value)}}}),e("input",{directives:[{name:"model",rawName:"v-model",value:t.task.title,expression:"task.title"}],attrs:{type:"text",placeholder:"请输入保存名"},domProps:{value:t.task.title},on:{input:function(e){e.target.composing||t.$set(t.task,"title",e.target.value)}}}),e("div",{on:{click:function(e){return t.addTask()}}},[t._v("添加任务("+t._s(t.taskCount)+")")])]),e("div",{staticClass:"m-p-temp-url"},[t._v("当前任务:")]),e("section",{staticClass:"m-p-input-container"},[e("input",{directives:[{name:"model",rawName:"v-model",value:t.url,expression:"url"}],attrs:{type:"text",disabled:"",placeholder:"请输入 m3u8 链接"},domProps:{value:t.url},on:{input:function(e){e.target.composing||(t.url=e.target.value)}}}),e("input",{directives:[{name:"model",rawName:"v-model",value:t.title,expression:"title"}],attrs:{type:"text",disabled:"",placeholder:"请输入保存名"},domProps:{value:t.title},on:{input:function(e){e.target.composing||(t.title=e.target.value)}}}),(!t.downloading||t.rangeDownload.isShowRange,t._e()),t.downloading?t.finishNum===t.rangeDownload.targetSegment&&t.rangeDownload.targetSegment>0?e("div",{staticClass:"disable"},[t._v("下载完成")]):e("div",{on:{click:t.togglePause}},[t._v(t._s(t.isPause?"恢复下载":"暂停下载"))]):[e("div",{on:{click:function(e){return t.start()}}},[t._v("原格式下载")]),t._e()]],2),!t.downloading&&t.isSupperStreamWrite?e("div",{staticClass:"m-p-stream",on:{click:function(e){return t.streamDownload(!1)}}},[t._v("特大视频原格式下载，边下载边保存，彻底解决大文件下载内存不足问题 ")]):t._e(),!t.downloading&&t.isSupperStreamWrite?e("div",{staticClass:"m-p-stream",on:{click:function(e){return t.streamDownload(!0)}}},[t._v("特大视频 MP4 格式下载，边下载边保存，彻底解决大文件下载内存不足问题 ")]):t._e(),t.finishList.length>0?[e("div",{staticClass:"m-p-line"}),t.mediaFileList.length&&!t.streamWriter?e("div",{staticClass:"m-p-force",on:{click:t.forceDownload}},[t._v("强制下载现有片段")]):t._e(),e("div",{staticClass:"m-p-tips"},[t._v("待下载碎片总量："+t._s(t.rangeDownload.targetSegment)+"，已下载："+t._s(t.finishNum)+"，错误："+t._s(t.errorNum)+"，进度："+t._s((t.finishNum/t.rangeDownload.targetSegment*100).toFixed(2))+"%")]),e("div",{staticClass:"m-p-tips",class:[t.errorNum?"error-tips":""]},[t._v("若某视频碎片下载发生错误，将标记为红色，可点击相应图标进行重试")]),e("section",{staticClass:"m-p-segment"},t._l(t.finishList,(function(i,s){return e("div",{key:s,staticClass:"item",class:[i.status],attrs:{title:i.title},on:{click:function(e){return t.retry(s)}}},[t._v(t._s(s+1))])})),0)]:t._e()],2)},r=[],a=(i(44114),i(16573),i(78100),i(77936),i(48140),i(21903),i(91134),i(28845),i(37467),i(44732),i(79577),i(14603),i(47566),i(98721),{name:"M3u8DownloaderView",metaInfo:{title:"M3U8视频下载器 - 在线视频下载工具",meta:[{name:"description",content:"M3U8视频下载器，支持解析M3U8播放列表并下载视频文件，提供多种下载工具命令。"},{name:"keywords",content:"M3U8下载,视频下载,在线视频,播放列表下载,FFmpeg"}]},data(){return{task:{url:"",title:""},taskCount:0,url:"",tips:"m3u8 视频在线提取工具",title:"",isPause:!1,isGetMP4:!1,durationSecond:0,isShowRefer:!1,downloading:!1,beginTime:"",errorNum:0,finishNum:0,downloadIndex:0,finishList:[],tsUrlList:[],mediaFileList:[],isSupperStreamWrite:window.streamSaver&&!window.streamSaver.useBlobFallback,streamWriter:null,streamDownloadIndex:0,rangeDownload:{isShowRange:!1,startSegment:"",endSegment:"",targetSegment:1},aesConf:{method:"",uri:"",iv:"",key:"",decryptor:null,stringToBuffer:function(t){return(new TextEncoder).encode(t)}}}},created(){this.getSource(),window.addEventListener("keyup",this.onKeyup),setInterval(this.retryAll.bind(this),2e3),setInterval((()=>{this.check()}),3e3),setTimeout((()=>{this.start()}),1e3)},beforeDestroy(){window.removeEventListener("keyup",this.onKeyup)},computed:{},methods:{start(){let t=this.getTask();t.length<=0||(this.url=t[0].url,this.title=t[0].title,this.getM3U8(!1))},check(){if(this.downloading&&this.finishNum===this.rangeDownload.targetSegment&&this.rangeDownload.targetSegment>0){let t=this.getTask();for(let e=0;e<t.length;e++)if(t[e].url===this.url){t.splice(e,1);break}localStorage.setItem("tasks",JSON.stringify(t)),history.go(0)}},getTask(){let t=JSON.parse(localStorage.getItem("tasks"))||[];return this.taskCount=t.length,t},addTask(){if(!this.task.url||!this.task.title)return alert("链接或名称，填写");let t=this.getTask();t.some((t=>t.url===this.task.url))?alert("已存在一样的"):(t.push({url:this.task.url,title:this.task.title}),localStorage.setItem("tasks",JSON.stringify(t)),this.task.url="",this.task.title="",this.getTask())},getSource(){let{href:t}=location;t.indexOf("?source=")>-1&&(this.url=t.split("?source=")[1])},getDocumentTitle(){return this.title},onKeyup(t){13===t.keyCode&&this.getM3U8()},ajax(t){t=t||{};let e=new XMLHttpRequest;"file"===t.type&&(e.responseType="arraybuffer"),e.onreadystatechange=function(){if(4===e.readyState){let i=e.status;i>=200&&i<300?t.success&&t.success(e.response):t.fail&&t.fail(i)}},e.open("GET",t.url,!0),e.send(null)},applyURL(t,e){if(e=e||location.href,0===t.indexOf("http"))return 0===location.href.indexOf("https")?t.replace("http://","https://"):t;if("/"===t[0]){let i=e.split("/");return i[0]+"//"+i[2]+t}{let i=e.split("/");return i.pop(),i.join("/")+"/"+t}},streamDownload(t){this.isGetMP4=t,this.title=new URL(this.url).searchParams.get("title")||this.title;let e=this.title||this.formatTime(new Date,"YYYY_MM_DD hh_mm_ss");"m3u8 downloader"!==document.title&&(e=this.getDocumentTitle()),this.streamWriter=window.streamSaver.createWriteStream(`${e}.${t?"mp4":"ts"}`).getWriter(),this.getM3U8()},getMP4(){this.isGetMP4=!0,this.getM3U8()},getM3U8(t){if(this.url)if(-1!==this.url.toLowerCase().indexOf("m3u8"))if(this.downloading)alert("资源下载中，请稍后");else if(location.href.indexOf("blog.luckly-mjw.cn")>-1&&-1===this.url.indexOf(location.protocol)){const t=new URL(this.url),e=`${t.protocol}//blog.luckly-mjw.cn/tool-show/m3u8-downloader/index.html?source=${this.url}`;"http:"===t.protocol?(this.copyToClipboard(e),alert("由于浏览器限制，无法从 https 跳转至 http。请在访问 http 协议页面，页面 url 已复制，直接粘贴使用即可")):location.href=e}else location.href.indexOf("blog.luckly-mjw.cn")>-1&&window.history.replaceState(null,"",`${location.href.split("?")[0]}?source=${this.url}`),this.title=new URL(this.url).searchParams.get("title")||this.title,this.tips="m3u8 文件下载中，请稍后",this.beginTime=new Date,this.ajax({url:this.url,success:e=>{if(this.tsUrlList=[],this.finishList=[],e.split("\n").forEach((t=>{/^[^#]/.test(t)&&(console.log(t),this.tsUrlList.push(this.applyURL(t,this.url)),this.finishList.push({title:t,status:""}))})),t)return this.rangeDownload.isShowRange=!0,this.rangeDownload.endSegment=this.tsUrlList.length,void(this.rangeDownload.targetSegment=this.tsUrlList.length);{let t=Math.max(this.rangeDownload.startSegment||1,1),e=Math.max(this.rangeDownload.endSegment||this.tsUrlList.length,1);t=Math.min(t,this.tsUrlList.length),e=Math.min(e,this.tsUrlList.length),this.rangeDownload.startSegment=Math.min(t,e),this.rangeDownload.endSegment=Math.max(t,e),this.rangeDownload.targetSegment=this.rangeDownload.endSegment-this.rangeDownload.startSegment+1,this.downloadIndex=this.rangeDownload.startSegment-1,this.downloading=!0}if(this.isGetMP4){let t=0;e.split("\n").forEach((e=>{e.toUpperCase().indexOf("#EXTINF:")>-1&&(t++,this.rangeDownload.startSegment<=t&&t<=this.rangeDownload.endSegment&&(this.durationSecond+=parseFloat(e.split("#EXTINF:")[1])))}))}e.indexOf("#EXT-X-KEY")>-1?(this.aesConf.method=(e.match(/(.*METHOD=([^,\s]+))/)||["","",""])[2],this.aesConf.uri=(e.match(/(.*URI="([^"]+))"/)||["","",""])[2],this.aesConf.iv=(e.match(/(.*IV=([^,\s]+))/)||["","",""])[2],this.aesConf.iv=this.aesConf.iv?this.aesConf.stringToBuffer(this.aesConf.iv):"",this.aesConf.uri=this.applyURL(this.aesConf.uri,this.url),this.getAES()):this.tsUrlList.length>0?this.downloadTS():this.alertError("资源为空，请查看链接是否有效")},fail:()=>{this.alertError("链接不正确，请查看链接是否有效")}});else alert("链接有误，请重新输入");else alert("请输入链接")},getAES(){this.ajax({type:"file",url:this.aesConf.uri,success:t=>{this.aesConf.key=t,this.aesConf.decryptor=new AESDecryptor,this.aesConf.decryptor.constructor(),this.aesConf.decryptor.expandKey(this.aesConf.key),this.downloadTS()},fail:()=>{this.alertError("视频已加密，可试用右下角入口的「无差别提取工具」")}})},aesDecrypt(t,e){let i=this.aesConf.iv||new Uint8Array([0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,e]);return this.aesConf.decryptor.decrypt(t,0,i.buffer||i,!0)},downloadTS(){this.tips="ts 视频碎片下载中，请稍后";let t=()=>{let e=this.isPause,i=this.downloadIndex;i>=this.rangeDownload.endSegment||(this.downloadIndex++,this.finishList[i]&&""===this.finishList[i].status?(this.finishList[i].status="downloading",this.ajax({url:this.tsUrlList[i],type:"file",success:s=>{this.dealTS(s,i,(()=>this.downloadIndex<this.rangeDownload.endSegment&&!e&&t()))},fail:()=>{this.errorNum++,this.finishList[i].status="error",this.downloadIndex<this.rangeDownload.endSegment&&!e&&t()}})):this.downloadIndex<this.rangeDownload.endSegment&&!e&&t())};for(let e=0;e<Math.min(6,this.rangeDownload.targetSegment-this.finishNum);e++)t()},dealTS(t,e,i){const s=this.aesConf.uri?this.aesDecrypt(t,e):t;this.conversionMp4(s,e,(t=>{if(this.mediaFileList[e-this.rangeDownload.startSegment+1]=t,this.finishList[e].status="finish",this.finishNum++,this.streamWriter){for(let t=this.streamDownloadIndex;t<this.mediaFileList.length;t++){if(!this.mediaFileList[t])break;this.streamWriter.write(new Uint8Array(this.mediaFileList[t])),this.mediaFileList[t]=null,this.streamDownloadIndex=t+1}this.streamDownloadIndex>=this.rangeDownload.targetSegment&&this.streamWriter.close()}else if(this.finishNum===this.rangeDownload.targetSegment){let t=this.title;this.downloadFile(this.mediaFileList,t)}i&&i()}))},conversionMp4(t,e,i){if(this.isGetMP4){let s=new muxjs.Transmuxer({keepOriginalTimestamps:!0,duration:parseInt(this.durationSecond)});s.on("data",(t=>{if(e===this.rangeDownload.startSegment-1){let e=new Uint8Array(t.initSegment.byteLength+t.data.byteLength);e.set(t.initSegment,0),e.set(t.data,t.initSegment.byteLength),i(e.buffer)}else i(t.data)})),s.push(new Uint8Array(t)),s.flush()}else i(t)},togglePause(){this.isPause=!this.isPause,!this.isPause&&this.retryAll(!0)},retry(t){"error"===this.finishList[t].status&&(this.finishList[t].status="",this.ajax({url:this.tsUrlList[t],type:"file",success:e=>{this.errorNum--,this.dealTS(e,t)},fail:()=>{this.finishList[t].status="error"}}))},retryAll(t){if(!this.finishList.length||this.isPause)return;let e=this.downloadIndex;this.finishList.forEach(((t,i)=>{"error"===t.status&&(t.status="",e=Math.min(e,i))})),this.errorNum=0,this.downloadIndex>=this.rangeDownload.endSegment||t?(this.downloadIndex=e,this.downloadTS()):this.downloadIndex=e},downloadFile(t,e){this.tips="ts 碎片整合中，请留意浏览器下载";let i=null,s=document.createElement("a");this.isGetMP4?(i=new Blob(t,{type:"video/mp4"}),s.download=e+".mp4"):(i=new Blob(t,{type:"video/MP2T"}),s.download=e+".ts"),s.href=URL.createObjectURL(i),s.style.display="none",document.body.appendChild(s),s.click(),s.remove()},formatTime(t,e){const i={Y:t.getFullYear(),M:t.getMonth()+1,D:t.getDate(),h:t.getHours(),m:t.getMinutes(),s:t.getSeconds()};return e.replace(/Y+|M+|D+|h+|m+|s+/g,(t=>(new Array(t.length).join("0")+i[t[0]]).substr(-t.length)))},forceDownload(){if(this.mediaFileList.length){let t=this.title;this.downloadFile(this.mediaFileList,t)}else alert("当前无已下载片段")},alertError(t){alert(t),this.downloading=!1,this.tips="m3u8 视频在线提取工具"},copyToClipboard(t){if(clearTimeout(this.timeouter),!document.queryCommandSupported("copy"))return!1;let e=document.createElement("textarea");e.style.opacity="0",e.value=t,document.body.appendChild(e),e.select();const i=document.execCommand("copy");return document.body.removeChild(e),e=null,i}}}),o=a,l=i(81656),h=(0,l.A)(o,n,r,!1,null,"21314982",null),d=h.exports,u=i(89143),c=i.n(u);s["default"].config.productionTip=!1,s["default"].use(c()),new s["default"]({render:t=>t(d),mounted(){document.dispatchEvent(new Event("render-event"))}}).$mount("#app")}},e={};function i(s){var n=e[s];if(void 0!==n)return n.exports;var r=e[s]={id:s,loaded:!1,exports:{}};return t[s].call(r.exports,r,r.exports,i),r.loaded=!0,r.exports}i.m=t,function(){i.amdD=function(){throw new Error("define cannot be used indirect")}}(),function(){i.amdO={}}(),function(){var t=[];i.O=function(e,s,n,r){if(!s){var a=1/0;for(d=0;d<t.length;d++){s=t[d][0],n=t[d][1],r=t[d][2];for(var o=!0,l=0;l<s.length;l++)(!1&r||a>=r)&&Object.keys(i.O).every((function(t){return i.O[t](s[l])}))?s.splice(l--,1):(o=!1,r<a&&(a=r));if(o){t.splice(d--,1);var h=n();void 0!==h&&(e=h)}}return e}r=r||0;for(var d=t.length;d>0&&t[d-1][2]>r;d--)t[d]=t[d-1];t[d]=[s,n,r]}}(),function(){i.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return i.d(e,{a:e}),e}}(),function(){i.d=function(t,e){for(var s in e)i.o(e,s)&&!i.o(t,s)&&Object.defineProperty(t,s,{enumerable:!0,get:e[s]})}}(),function(){i.g=function(){if("object"===typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(t){if("object"===typeof window)return window}}()}(),function(){i.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)}}(),function(){i.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})}}(),function(){i.nmd=function(t){return t.paths=[],t.children||(t.children=[]),t}}(),function(){i.j=1555}(),function(){var t={1555:0};i.O.j=function(e){return 0===t[e]};var e=function(e,s){var n,r,a=s[0],o=s[1],l=s[2],h=0;if(a.some((function(e){return 0!==t[e]}))){for(n in o)i.o(o,n)&&(i.m[n]=o[n]);if(l)var d=l(i)}for(e&&e(s);h<a.length;h++)r=a[h],i.o(t,r)&&t[r]&&t[r][0](),t[r]=0;return i.O(d)},s=self["webpackChunkweb_tool_vue"]=self["webpackChunkweb_tool_vue"]||[];s.forEach(e.bind(null,0)),s.push=e.bind(null,s.push.bind(s))}();var s=i.O(void 0,[504],(function(){return i(12332)}));s=i.O(s)})();